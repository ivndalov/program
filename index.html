<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>OurSpace</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="OurSpace">
    <meta name="theme-color" content="#1a0f1f">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/192/love-circled.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#1a0f1f',
                        primary: '#ff69b4',
                        secondary: '#8b5cf6',
                        surface: 'rgba(255, 255, 255, 0.1)',
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'heartbeat': 'heartbeat 1.5s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        heartbeat: {
                            '0%': { transform: 'scale(1)' },
                            '14%': { transform: 'scale(1.1)' },
                            '28%': { transform: 'scale(1)' },
                            '42%': { transform: 'scale(1.1)' },
                            '70%': { transform: 'scale(1)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* iOS Fixes */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #1a0f1f;
            color: white;
            overscroll-behavior-y: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            height: 100vh;
            overflow: hidden;
        }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .glass-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.01) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 20px;
        }

        /* Neon Glow */
        .neon-text {
            text-shadow: 0 0 10px rgba(255, 105, 180, 0.7), 0 0 20px rgba(255, 105, 180, 0.5);
        }

        .bg-glow {
            position: absolute;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255,105,180,0.4) 0%, rgba(26,15,31,0) 70%);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: -1;
            pointer-events: none;
        }

        /* Custom Scrollbar for content areas */
        .scroll-hidden::-webkit-scrollbar {
            display: none;
        }
        .scroll-hidden {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Animations */
        .page-transition {
            animation: fadeUp 0.4s ease-out forwards;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .shake { animation: shake 0.5s; }

        input::placeholder { color: rgba(255,255,255,0.3); }
    </style>
</head>
<body>

    <div class="bg-glow animate-pulse-slow"></div>
    <div id="particles"></div>

    <div id="loginScreen" class="fixed inset-0 z-50 flex flex-col items-center justify-center p-6 bg-bg transition-opacity duration-500">
        <div class="text-6xl mb-8 animate-heartbeat">üîí</div>
        <h1 class="text-2xl font-bold mb-2 text-center text-primary neon-text">OurSpace</h1>
        <p class="text-gray-300 mb-8 text-center text-sm">–í–≤–µ–¥—ñ—Ç—å –¥–∞—Ç—É –Ω–∞—à–æ–≥–æ –ø–æ—á–∞—Ç–∫—É</p>
        
        <input type="tel" id="passcode" maxlength="8" placeholder="–î–î–ú–ú–†–†–†–†" 
               class="glass text-center text-2xl tracking-widest text-white rounded-full py-4 px-6 w-64 focus:outline-none focus:border-primary transition-all mb-6">
        
        <button onclick="checkPasscodeManual()" class="bg-primary text-white font-bold py-3 px-8 rounded-full shadow-lg active:scale-95 transition-transform">
            –í—ñ–¥–∫—Ä–∏—Ç–∏ ‚ù§Ô∏è
        </button>
        
        <p id="errorMsg" class="text-red-400 mt-6 text-sm opacity-0 transition-opacity">–°–ø—Ä–æ–±—É–π —â–µ, –º–æ—è –ª—é–±–æ–≤–µ ‚ù§Ô∏è</p>
    </div>

    <div id="appScreen" class="hidden h-full flex flex-col">
        
        <header class="pt-12 pb-4 px-6 flex justify-between items-center glass border-b-0 rounded-b-3xl z-20">
            <div>
                <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-purple-400">–í—ñ—Ç—É—Å—å–∫–∞</h1>
                <div class="flex items-center gap-2 text-xs text-gray-300">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                    –°—Ç–∞—Ç—É—Å: –ö–æ—Ö–∞–Ω–Ω—è 1000%
                </div>
            </div>
            <div class="glass px-3 py-1 rounded-full flex items-center gap-2">
                <i class="fas fa-coins text-yellow-400"></i>
                <span id="coinBalance" class="font-bold">500</span>
            </div>
        </header>

        <main id="mainContent" class="flex-1 overflow-y-auto scroll-hidden p-6 pb-24 relative page-transition">
            </main>

        <nav class="fixed bottom-6 left-6 right-6 h-20 glass rounded-2xl flex justify-around items-center z-40 shadow-2xl">
            <button onclick="router('home')" class="nav-btn text-gray-400 hover:text-primary transition-colors flex flex-col items-center gap-1 active:scale-90 duration-200">
                <i class="fas fa-heart text-2xl"></i>
                <span class="text-[10px]">–ì–æ–ª–æ–≤–Ω–∞</span>
            </button>
            <button onclick="router('store')" class="nav-btn text-gray-400 hover:text-primary transition-colors flex flex-col items-center gap-1 active:scale-90 duration-200">
                <i class="fas fa-store text-2xl"></i>
                <span class="text-[10px]">–ú–∞–≥–∞–∑–∏–Ω</span>
            </button>
            <button onclick="router('letters')" class="nav-btn text-gray-400 hover:text-primary transition-colors flex flex-col items-center gap-1 active:scale-90 duration-200">
                <i class="fas fa-envelope-open-text text-2xl"></i>
                <span class="text-[10px]">–õ–∏—Å—Ç–∏</span>
            </button>
        </nav>

    </div>

    <div id="buyModal" class="hidden fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 page-transition">
        <div class="glass-card w-full max-w-sm p-6 text-center">
            <div class="w-16 h-16 rounded-full bg-primary/20 flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-question text-3xl text-primary"></i>
            </div>
            <h3 class="text-xl font-bold mb-2">–¢–∏ –≤–ø–µ–≤–Ω–µ–Ω–∞, –ø—Ä–∏–Ω—Ü–µ—Å–æ?</h3>
            <p class="text-gray-300 mb-6 text-sm">–¶–µ –∫–æ—à—Ç—É–≤–∞—Ç–∏–º–µ <span id="modalPrice" class="font-bold text-primary"></span> –º–æ–Ω–µ—Ç.</p>
            <div class="flex gap-4">
                <button onclick="closeModal('buyModal')" class="flex-1 py-3 rounded-xl bg-gray-700 text-white font-medium hover:bg-gray-600">–ù—ñ</button>
                <button onclick="confirmPurchase()" class="flex-1 py-3 rounded-xl bg-gradient-to-r from-primary to-purple-600 text-white font-bold shadow-lg shadow-primary/30">–¢–∞–∫ ‚ù§Ô∏è</button>
            </div>
        </div>
    </div>

    <div id="ticketModal" class="hidden fixed inset-0 z-[70] bg-black/90 backdrop-blur-md flex items-center justify-center p-4 page-transition">
        <div class="glass-card w-full max-w-sm p-0 overflow-hidden relative">
            <div class="bg-gradient-to-r from-primary to-purple-600 p-4 text-center">
                <h3 class="text-white font-bold text-lg tracking-widest">OURSPACE TICKET</h3>
            </div>
            <div class="p-8 flex flex-col items-center border-b border-dashed border-gray-500 relative bg-white/5">
                <div class="absolute -left-3 top-1/2 w-6 h-6 bg-[#1a0f1f] rounded-full"></div>
                <div class="absolute -right-3 top-1/2 w-6 h-6 bg-[#1a0f1f] rounded-full"></div>
                
                <h2 id="ticketTitle" class="text-2xl font-bold text-center mb-2 neon-text">–ú–∞—Å–∞–∂</h2>
                <p class="text-gray-400 text-xs mb-4">–î–Ü–ô–°–ù–ò–ô –ü–†–û–¢–Ø–ì–û–ú 24 –ì–û–î–ò–ù</p>
                <div class="w-32 h-32 bg-white p-2 rounded-lg mb-4">
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=LoveForVituska" class="w-full h-full object-cover opacity-90">
                </div>
                <p class="text-xs text-gray-500 font-mono">ID: <span id="ticketId">LOVE-001</span></p>
            </div>
            <div class="p-4">
                 <a id="emailLink" href="#" class="block w-full text-center py-3 rounded-xl bg-white text-bg font-bold hover:bg-gray-200 transition-colors">
                    <i class="fas fa-paper-plane mr-2"></i> –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ü–ª–ª—ñ
                </a>
                <button onclick="closeModal('ticketModal')" class="block w-full text-center mt-3 text-sm text-gray-400 hover:text-white">–ó–∞–∫—Ä–∏—Ç–∏</button>
            </div>
        </div>
    </div>

    <div id="letterModal" class="hidden fixed inset-0 z-[60] bg-[#1a0f1f] flex flex-col page-transition">
        <div class="p-4 flex justify-between items-center glass">
            <button onclick="closeModal('letterModal')" class="text-gray-400 hover:text-white"><i class="fas fa-arrow-left text-xl"></i></button>
            <span class="font-bold text-primary">–î–ª—è —Ç–µ–±–µ üíå</span>
            <div class="w-6"></div>
        </div>
        <div id="letterContent" class="flex-1 p-6 overflow-y-auto">
            </div>
    </div>

    <script>
        // --- DATA & CONFIG ---
        const CONFIG = {
            startDate: new Date("2020-11-10T00:00:00"),
            passcode: "10112020",
            email: "illia.nazarivskyi.crowner@gmail.com"
        };

        const ITEMS = [
            { id: 1, title: "–ö–∞–≤–∞/–ß–∞–π", price: 20, icon: "‚òï" },
            { id: 2, title: "–ü–æ—Ü—ñ–ª—É–Ω–æ–∫", price: 30, icon: "üíã" },
            { id: 3, title: "–û–±—ñ–π–º–∏ (10 —Ö–≤)", price: 40, icon: "ü§ó" },
            { id: 4, title: "–ú–∞—Å–∞–∂ –Ω—ñ–≥", price: 50, icon: "ü¶∂" },
            { id: 5, title: "–ú–∞—Å–∞–∂ —Å–ø–∏–Ω–∏", price: 70, icon: "üíÜ‚Äç‚ôÄÔ∏è" },
            { id: 6, title: "–°–Ω—ñ–¥–∞–Ω–æ–∫ —É –ª—ñ–∂–∫–æ", price: 80, icon: "ü•û" },
            { id: 7, title: "–í–µ—á–µ—Ä—è –≤—ñ–¥ –Ü–ª–ª—ñ", price: 90, icon: "üçù" },
            { id: 8, title: "–ö—ñ–Ω–æ (—Ç–≤—ñ–π –≤–∏–±—ñ—Ä)", price: 110, icon: "üé¨" },
            { id: 9, title: "–î–∂–æ–∫–µ—Ä (Win)", price: 200, icon: "üÉè", weekly: true }
        ];

        const LETTERS = [
            { id: 'sad', title: "–ö–æ–ª–∏ —Ç–æ–±—ñ —Å—É–º–Ω–æ", icon: "üò¢", content: `<p class="mb-4">–ú–æ—è —Ä—ñ–¥–Ω–∞, –ø–∞–º'—è—Ç–∞–π: –∂–æ–¥–µ–Ω –¥–æ—â –Ω–µ –π–¥–µ –≤—ñ—á–Ω–æ. –Ø –ø–æ—Ä—É—á, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —Ñ—ñ–∑–∏—á–Ω–æ –¥–∞–ª–µ–∫–æ.</p><img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExajZ4ZnV4ZnV4ZnV4ZnV4ZnV4ZnV4ZnV4ZnV4ZnV4ZnV4ZnV4ZnV4ZiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3oEdv4hwTZKSjEBsWS/giphy.gif" class="rounded-xl w-full mb-4"><p>–¢–∏ ‚Äî –º–æ—î —Å–æ–Ω—Ü–µ. –í–∏—Ç—Ä–∏ —Å–ª—ñ–∑–∫–∏, –±–æ –≤–æ–Ω–∏ –∑–∞–Ω–∞–¥—Ç–æ –¥–æ—Ä–æ–≥—ñ.</p>` },
            { id: 'miss', title: "–ö–æ–ª–∏ —Å—É–º—É—î—à", icon: "ü•∫", content: `<p class="mb-4">–Ø —Ç–µ–∂ –∑–∞ —Ç–æ–±–æ—é —Å—É–º—É—é. –ö–æ–∂–Ω—É —Å–µ–∫—É–Ω–¥—É.</p><p>–ó–∞–∫—Ä–∏–π –æ—á—ñ —ñ —É—è–≤–∏, —â–æ —è —Ç–µ–±–µ –º—ñ—Ü–Ω–æ –æ–±—ñ–π–º–∞—é.</p><img src="https://media.giphy.com/media/l4pTdcifPZLpDjL1e/giphy.gif" class="rounded-xl w-full">` },
            { id: 'mad', title: "–ö–æ–ª–∏ –∑–ª–∏—à—Å—è", icon: "üò°", content: `<p class="mb-4">–Ø –∑–Ω–∞—é, —â–æ —è —ñ–Ω–æ–¥—ñ –±—É–≤–∞—é –Ω–µ—Å—Ç–µ—Ä–ø–Ω–∏–º. –ü—Ä–æ–±–∞—á –º–µ–Ω—ñ, –±—É–¥—å –ª–∞—Å–∫–∞.</p><p>–î–∞–≤–∞–π –Ω–µ –±—É–¥–µ–º–æ –≤–∏—Ç—Ä–∞—á–∞—Ç–∏ —á–∞—Å –Ω–∞ —Å–≤–∞—Ä–∫–∏? –õ—é–±–ª—é —Ç–µ–±–µ!</p>` },
            { id: 'sleep', title: "–ù–µ –º–æ–∂–µ—à —Å–ø–∞—Ç–∏", icon: "üò¥", content: `<p>–°–ø—Ä–æ–±—É–π –ø–æ—Ä–∞—Ö—É–≤–∞—Ç–∏ –Ω–µ –æ–≤–µ—Ü—å, –∞ –Ω–∞—à—ñ –ø–æ—Ü—ñ–ª—É–Ω–∫–∏. –á—Ö –±—É–ª–æ –º—ñ–ª—å–π–æ–Ω–∏.</p><iframe class="w-full h-48 rounded-xl mb-4" src="https://www.youtube.com/embed/jfKfPfyJRdk" frameborder="0" allowfullscreen></iframe>` },
            { id: 'now', title: "–í–Ü–î–ö–†–ò–ô –ó–ê–†–ê–ó", icon: "üíñ", content: `<h2 class="text-2xl font-bold text-primary mb-4">–ó –î–Ω–µ–º –°–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞!</h2><p class="mb-4">–¢–∏ ‚Äî –Ω–∞–π–∫—Ä–∞—â–µ, —â–æ —Ç—Ä–∞–ø–ª—è–ª–æ—Å—è –≤ –º–æ—î–º—É –∂–∏—Ç—Ç—ñ. –î—è–∫—É–ª—é —Ç–æ–±—ñ –∑–∞ —Ç–µ, —â–æ —Ç–∏ —î.</p><p>–£ –Ω–µ–¥—ñ–ª—é –±—É–¥–µ –Ω–∞—à–µ —Å–ø—Ä–∞–≤–∂–Ω—î —Å–≤—è—Ç–æ. –ê –ø–æ–∫–∏ ‚Äî —Ç—Ä–∏–º–∞–π —Ü–µ–π —Ü–∏—Ñ—Ä–æ–≤–∏–π –≤—Å–µ—Å–≤—ñ—Ç.</p>` },
            { id: 'proud', title: "–ö–æ–ª–∏ –≥–æ—Ä–¥–∞", icon: "üèÜ", content: `<p>–¢–∏ ‚Äî —Ä–æ–∑—É–º–Ω–∏—á–∫–∞! –Ø –∑–∞–≤–∂–¥–∏ –∑–Ω–∞–≤, —â–æ —Ç–∏ –∑–º–æ–∂–µ—à. –ü–∏—à–∞—é—Å—è —Ç–æ–±–æ—é –±–µ–∑–º–µ–∂–Ω–æ!</p>` },
            { id: 'smile', title: "–•–æ—á–µ—à —É—Å–º—ñ—à–∫—É", icon: "üòä", content: `<p>–ß–æ–º—É —Å–∫–µ–ª–µ—Ç –Ω–µ –ø—ñ—à–æ–≤ –Ω–∞ –¥–∏—Å–∫–æ—Ç–µ–∫—É? –ë–æ –π–æ–º—É –Ω–µ –±—É–ª–æ –∑ –∫–∏–º –ø—ñ—Ç–∏ (–±–∞-–¥—É–º-—Ç—Å)! –ü–æ—Å–º—ñ—Ö–Ω–∏—Å—å, —Ç–æ–±—ñ —Ü–µ —Ç–∞–∫ –ª–∏—á–∏—Ç—å.</p>` },
            { id: 'support', title: "–ü–æ—Ç—Ä—ñ–±–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞", icon: "ü§ó", content: `<p>–¢–∏ —Å–∏–ª—å–Ω—ñ—à–∞, –Ω—ñ–∂ –¥—É–º–∞—î—à. –£ —Ç–µ–±–µ –≤—Å–µ –≤–∏–π–¥–µ, –∞ —è –ø–æ–¥–∞–≤–∞—Ç–∏–º—É –ø–∞—Ç—Ä–æ–Ω–∏.</p>` },
            { id: 'romantic', title: "–†–æ–º–∞–Ω—Ç–∏–∫–∞", icon: "üåπ", content: `<p>–¢–≤–æ—ó –æ—á—ñ —è–∫ –æ–∫–µ–∞–Ω, –≤ —è–∫–æ–º—É —è —Ö–æ—á—É —Ç–æ–Ω—É—Ç–∏ –≤—ñ—á–Ω–æ...</p>` },
            { id: 'hungry', title: "–ö–æ–ª–∏ –≥–æ–ª–æ–¥–Ω–∞", icon: "üçì", content: `<p>–¢–µ—Ä–º—ñ–Ω–æ–≤–æ –∑'—ó–∂ —â–æ—Å—å —Å–º–∞—á–Ω–µ–Ω—å–∫–µ! –ê–±–æ –Ω–∞–ø–∏—à–∏ –º–µ–Ω—ñ, —è –∑–∞–º–æ–≤–ª—é –¥–æ—Å—Ç–∞–≤–∫—É.</p>` },
            { id: 'tired', title: "–í—Ç–æ–º–ª–µ–Ω–∞", icon: "üò©", content: `<p>–í—ñ–¥–∫–ª–∞–¥–∏ –≤—Å–µ. –¢–∏ —É —Å–µ–±–µ –æ–¥–Ω–∞. –õ—è–≥–∞–π, –≤—ñ–¥–ø–æ—á–∏–Ω—å, —Å–≤—ñ—Ç –ø–æ—á–µ–∫–∞—î.</p>` },
            { id: 'love', title: "–•–æ—á–µ—à '–õ—é–±–ª—é'", icon: "‚ù§Ô∏è", content: `<h1 class="text-4xl text-center text-primary font-bold animate-pulse">–Ø –¢–ï–ë–ï –õ–Æ–ë–õ–Æ!</h1>` },
        ];

        // --- STATE & VARS ---
        let appState = JSON.parse(localStorage.getItem('ourSpaceData')) || {
            coins: 500,
            purchases: [],
            openedLetters: [],
            lastLogin: null
        };
        
        let els = {}; // defined in init to avoid null error

        // --- INIT ---
        function init() {
            // Bind DOM elements NOW, when we are sure they exist
            els = {
                login: document.getElementById('loginScreen'),
                app: document.getElementById('appScreen'),
                passcode: document.getElementById('passcode'),
                content: document.getElementById('mainContent'),
                balance: document.getElementById('coinBalance'),
                error: document.getElementById('errorMsg')
            };

            // Setup listeners
            if (localStorage.getItem('isLoggedIn')) {
                showApp();
            } else {
                // Keep auto-check for convenience
                els.passcode.addEventListener('input', (e) => {
                    if (e.target.value.length === 8) checkPasscodeManual();
                });
            }

            // Daily bonus check
            const today = new Date().toDateString();
            if (localStorage.getItem('isLoggedIn') && appState.lastLogin !== today) {
                appState.coins += 100;
                appState.lastLogin = today;
                saveState();
                setTimeout(() => {
                    if (!els.app.classList.contains('hidden')) {
                        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                        showToast("–î–æ–±—Ä–æ–≥–æ —Ä–∞–Ω–∫—É! +100 –º–æ–Ω–µ—Ç ‚ù§Ô∏è");
                    }
                }, 2000);
            }
        }

        // --- LOGIN LOGIC ---
        function checkPasscodeManual() {
            const val = document.getElementById('passcode').value;
            if (val === CONFIG.passcode) {
                // Success
                document.getElementById('passcode').blur();
                localStorage.setItem('isLoggedIn', 'true');
                
                // Haptic if supported
                if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
                
                // Animation
                document.getElementById('loginScreen').classList.add('opacity-0');
                setTimeout(() => {
                    document.getElementById('loginScreen').classList.add('hidden');
                    showApp();
                }, 500);
            } else {
                // Error
                if (navigator.vibrate) navigator.vibrate(500);
                const input = document.getElementById('passcode');
                const err = document.getElementById('errorMsg');
                
                input.classList.add('shake', 'border-red-500', 'border-2');
                err.classList.remove('opacity-0');
                
                setTimeout(() => {
                    input.classList.remove('shake', 'border-red-500', 'border-2');
                    input.value = '';
                }, 1000);
            }
        }

        function showApp() {
            els.app.classList.remove('hidden');
            updateBalance();
            router('home');
        }

        function saveState() {
            localStorage.setItem('ourSpaceData', JSON.stringify(appState));
            updateBalance();
        }

        function updateBalance() {
            if(els.balance) els.balance.innerText = appState.coins;
        }

        // --- ROUTING ---
        function router(route) {
            const content = els.content;
            content.innerHTML = '';
            
            if (route === 'home') renderHome(content);
            if (route === 'store') renderStore(content);
            if (route === 'letters') renderLetters(content);
        }

        // --- RENDERERS ---
        function renderHome(container) {
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full space-y-8 page-transition">
                    <div id="timerContainer" class="text-center relative py-10 active:scale-95 transition-transform" onclick="handleTimerClick()">
                        <div class="text-gray-400 text-sm uppercase tracking-widest mb-2">–ú–∏ —Ä–∞–∑–æ–º</div>
                        <h2 id="daysCounter" class="text-6xl font-bold text-white mb-2 neon-text">0</h2>
                        <span class="text-xl text-primary">–¥–Ω—ñ–≤</span>
                        <div id="timeCounter" class="text-gray-300 font-mono mt-4 text-lg">00:00:00</div>
                        <div class="text-[10px] text-gray-500 mt-2">–∑ 10.11.2020</div>
                    </div>
                    
                    <div class="w-full glass-card p-4">
                        <h3 class="text-lg font-bold mb-2 text-primary">–¶–∏—Ç–∞—Ç–∞ –¥–Ω—è</h3>
                        <p class="text-sm italic text-gray-300">"–Ø –ª—é–±–ª—é —Ç–µ–±–µ –Ω–µ –∑–∞ —Ç–µ, —Ö—Ç–æ —Ç–∏, –∞ –∑–∞ —Ç–µ, —Ö—Ç–æ —è, –∫–æ–ª–∏ —è –∑ —Ç–æ–±–æ—é."</p>
                    </div>
                </div>
            `;
            startTimer();
        }

        function renderStore(container) {
            const grid = document.createElement('div');
            grid.className = 'grid grid-cols-2 gap-4 page-transition';
            
            ITEMS.forEach(item => {
                const lastPurchase = appState.purchases.filter(p => p.itemId === item.id).sort((a,b) => b.ts - a.ts)[0];
                let onCooldown = false;
                let timeLeftStr = "";

                if (lastPurchase) {
                    const diff = Date.now() - lastPurchase.ts;
                    const cdTime = (item.weekly ? 7 * 24 : 24) * 60 * 60 * 1000;
                    if (diff < cdTime) {
                        onCooldown = true;
                        const hoursLeft = Math.ceil((cdTime - diff) / (1000 * 60 * 60));
                        timeLeftStr = `${hoursLeft} –≥–æ–¥`;
                    }
                }

                const card = document.createElement('div');
                card.className = `glass-card p-4 flex flex-col items-center justify-between text-center min-h-[160px] ${onCooldown ? 'opacity-50 grayscale' : 'active:scale-95 transition-transform'}`;
                card.onclick = () => !onCooldown && openBuyModal(item);
                
                card.innerHTML = `
                    <div class="text-4xl mb-2">${item.icon}</div>
                    <div class="font-bold text-sm mb-1 leading-tight">${item.title}</div>
                    ${onCooldown 
                        ? `<div class="text-xs text-red-300 font-mono mt-2">‚è≥ ${timeLeftStr}</div>` 
                        : `<div class="text-primary font-bold mt-auto">${item.price} ü™ô</div>`
                    }
                `;
                grid.appendChild(card);
            });
            
            container.innerHTML = `<h2 class="text-xl font-bold mb-4 pl-2">–ú–∞–≥–∞–∑–∏–Ω –ë–∞–∂–∞–Ω—å</h2>`;
            container.appendChild(grid);
        }

        function renderLetters(container) {
            const grid = document.createElement('div');
            grid.className = 'grid grid-cols-3 gap-3 page-transition';
            
            LETTERS.forEach(letter => {
                const isOpened = appState.openedLetters.includes(letter.id);
                
                const card = document.createElement('div');
                card.className = `glass-card aspect-square flex flex-col items-center justify-center p-2 text-center transition-all ${isOpened ? 'border-primary/50 bg-primary/10' : 'active:scale-95'}`;
                card.onclick = () => openLetter(letter);
                
                card.innerHTML = isOpened 
                    ? `<div class="text-2xl mb-1">${letter.icon}</div><div class="text-[8px] text-gray-300 leading-tight">${letter.title}</div>`
                    : `<i class="fas fa-envelope text-3xl text-gray-400"></i><div class="text-[8px] text-gray-500 mt-2">–í—ñ–¥–∫—Ä–∏–π</div>`;
                
                grid.appendChild(card);
            });

            container.innerHTML = `<h2 class="text-xl font-bold mb-4 pl-2">–í—ñ–¥–∫—Ä–∏–π, –∫–æ–ª–∏...</h2>`;
            container.appendChild(grid);
        }

        // --- ACTIONS ---
        let timerInterval;
        let timerClicks = 0;

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            function update() {
                const now = new Date();
                const diff = now - CONFIG.startDate;
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
                const minutes = Math.floor((diff / (1000 * 60)) % 60);
                const seconds = Math.floor((diff / 1000) % 60);

                const dayEl = document.getElementById('daysCounter');
                const timeEl = document.getElementById('timeCounter');
                
                if (dayEl) dayEl.innerText = days;
                if (timeEl) timeEl.innerText = `${String(hours).padStart(2, '0')} –≥–æ–¥ ${String(minutes).padStart(2, '0')} —Ö–≤ ${String(seconds).padStart(2, '0')} —Å`;
            }
            
            update();
            timerInterval = setInterval(update, 1000);
        }

        function handleTimerClick() {
            timerClicks++;
            if (timerClicks === 10) {
                confetti({
                    particleCount: 200,
                    spread: 100,
                    origin: { y: 0.6 },
                    colors: ['#ff69b4', '#ffffff']
                });
                showToast("–ü–ê–°–•–ê–õ–ö–ê! +50 –º–æ–Ω–µ—Ç!");
                appState.coins += 50;
                saveState();
                timerClicks = 0;
            }
        }

        let selectedItem = null;

        function openBuyModal(item) {
            if (appState.coins < item.price) {
                showToast("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –º–æ–Ω–µ—Ç ü•∫");
                return;
            }
            selectedItem = item;
            document.getElementById('modalPrice').innerText = item.price;
            document.getElementById('buyModal').classList.remove('hidden');
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
        }

        function confirmPurchase() {
            if (!selectedItem) return;
            
            appState.coins -= selectedItem.price;
            appState.purchases.push({ itemId: selectedItem.id, ts: Date.now() });
            saveState();
            
            closeModal('buyModal');
            
            const ticketModal = document.getElementById('ticketModal');
            document.getElementById('ticketTitle').innerText = selectedItem.title;
            document.getElementById('ticketId').innerText = `LOVE-${Math.floor(Math.random()*10000)}`;
            
            const subject = encodeURIComponent(`OurSpace: –í—ñ—Ç—É—Å—å–∫–∞ –∫—É–ø–∏–ª–∞ ${selectedItem.title}!`);
            const body = encodeURIComponent(`–ü—Ä–∏–≤—ñ—Ç, –Ü–ª–ª—è!\n\n–Ø —â–æ–π–Ω–æ –∫—É–ø–∏–ª–∞ "${selectedItem.title}" –∑–∞ ${selectedItem.price} –º–æ–Ω–µ—Ç.\n\n–ö–æ–ª–∏ –≤–∏–∫–æ–Ω–∞—î—à? ‚ù§Ô∏è`);
            document.getElementById('emailLink').href = `mailto:${CONFIG.email}?subject=${subject}&body=${body}`;

            ticketModal.classList.remove('hidden');
            confetti({ particleCount: 150, spread: 60 });
        }

        function openLetter(letter) {
            const modal = document.getElementById('letterModal');
            const content = document.getElementById('letterContent');
            
            content.innerHTML = `
                <div class="text-center mb-6">
                    <div class="text-6xl mb-4 animate-float">${letter.icon}</div>
                    <h2 class="text-2xl font-bold text-white">${letter.title}</h2>
                </div>
                <div class="text-gray-200 leading-relaxed space-y-4">
                    ${letter.content}
                </div>
            `;
            
            modal.classList.remove('hidden');

            if (!appState.openedLetters.includes(letter.id)) {
                appState.openedLetters.push(letter.id);
                appState.coins += 25;
                saveState();
                setTimeout(() => {
                    confetti({ particleCount: 50, origin: { y: 0.8 } });
                    showToast("+25 –º–æ–Ω–µ—Ç –∑–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è!");
                }, 1000);
            }
        }

        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-6 left-1/2 transform -translate-x-1/2 bg-white/10 backdrop-blur-md border border-white/20 px-6 py-3 rounded-full text-sm font-bold shadow-xl z-[100] animate-bounce';
            toast.innerText = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // STARTUP
        window.onload = init;

    </script>
</body>
</html>
