<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>OurSpace</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="OurSpace">
    <meta name="theme-color" content="#1a0f1f">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/192/love-circled.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#1a0f1f',
                        primary: '#ff69b4',
                        secondary: '#8b5cf6',
                        glass: 'rgba(255, 255, 255, 0.08)',
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'heartbeat': 'heartbeat 1.5s ease-in-out infinite',
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        heartbeat: {
                            '0%': { transform: 'scale(1)' },
                            '14%': { transform: 'scale(1.1)' },
                            '28%': { transform: 'scale(1)' },
                            '42%': { transform: 'scale(1.1)' },
                            '70%': { transform: 'scale(1)' },
                        },
                        slideUp: {
                            '0%': { transform: 'translate(-50%, 100%)', opacity: 0 },
                            '100%': { transform: 'translate(-50%, 0)', opacity: 1 },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* iOS Fixes & Reset */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #1a0f1f;
            color: white;
            overscroll-behavior-y: none; /* –ó–∞–±–æ—Ä–æ–Ω–∞ –ø—Ä—É–∂–∏–Ω–∏ */
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            height: 100vh;
            width: 100%; /* FIX: –ë—É–ª–æ 100vw, —â–æ –≤–∏–∫–ª–∏–∫–∞–ª–æ –∑—Å—É–≤ */
            overflow: hidden;
            position: fixed; /* –§—ñ–∫—Å–∞—Ü—ñ—è –µ–∫—Ä–∞–Ω—É */
        }

        /* Safe Area Utilities */
        .safe-top {
            padding-top: env(safe-area-inset-top);
        }
        .safe-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* Premium Glassmorphism */
        .glass {
            background: rgba(26, 15, 31, 0.85); /* –¢–µ–º–Ω—ñ—à–∏–π –¥–ª—è –∫—Ä–∞—â–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞—Å—Ç—É */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .glass-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.01) 100%);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        /* Toast Notification Style */
        .toast-notification {
            position: fixed;
            bottom: 110px; /* –¢—Ä–æ—Ö–∏ –≤–∏—â–µ –º–µ–Ω—é */
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 105, 180, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            box-shadow: 0 10px 25px rgba(255, 105, 180, 0.4);
            font-weight: 600;
            font-size: 14px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
        }

        /* Neon Glow Background */
        .bg-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 30%, rgba(255,105,180,0.15) 0%, rgba(26,15,31,0) 60%);
            z-index: -1;
            pointer-events: none;
        }

        /* Scrollbar Hide */
        .scroll-hidden::-webkit-scrollbar { display: none; }
        .scroll-hidden { -ms-overflow-style: none; scrollbar-width: none; }

        input::placeholder { color: rgba(255,255,255,0.2); }
        
        .nav-active { color: #ff69b4; transform: scale(1.1); }
        .nav-active i { filter: drop-shadow(0 0 8px rgba(255,105,180,0.6)); }

        /* –¶–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –¥–ª—è –º–æ–¥–∞–ª–æ–∫ */
        .center-flex {
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>

    <div class="bg-glow animate-pulse-slow"></div>

    <div id="loginScreen" class="fixed inset-0 z-50 flex flex-col items-center justify-center p-6 bg-[#1a0f1f] transition-opacity duration-500 w-full h-full">
        <div class="text-6xl mb-8 animate-heartbeat">üîí</div>
        <h1 class="text-2xl font-bold mb-2 text-center text-primary tracking-wide">OurSpace</h1>
        <p class="text-gray-400 mb-8 text-center text-sm">–í–≤–µ–¥—ñ—Ç—å –¥–∞—Ç—É –Ω–∞—à–æ–≥–æ –ø–æ—á–∞—Ç–∫—É</p>
        
        <input type="tel" id="passcode" maxlength="8" placeholder="–î–î–ú–ú–†–†–†–†" 
               class="glass-card text-center text-2xl tracking-[0.2em] text-white py-4 px-6 w-64 focus:outline-none focus:border-primary transition-all mb-8 border-transparent">
        
        <button onclick="checkPasscodeManual()" class="bg-gradient-to-r from-primary to-purple-600 text-white font-bold py-4 px-10 rounded-full shadow-lg shadow-primary/30 active:scale-95 transition-transform">
            –í—ñ–¥–∫—Ä–∏—Ç–∏ ‚ù§Ô∏è
        </button>
        
        <p id="errorMsg" class="text-red-400 mt-6 text-sm opacity-0 transition-opacity font-medium">–°–ø—Ä–æ–±—É–π —â–µ, –º–æ—è –ª—é–±–æ–≤–µ ‚ù§Ô∏è</p>
    </div>

    <div id="appScreen" class="hidden h-full w-full flex flex-col relative">
        
        <header class="absolute top-0 left-0 right-0 z-20 glass safe-top w-full">
            <div class="px-6 py-4 flex justify-between items-center w-full">
                <div class="flex flex-col items-start"> <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400">–í—ñ—Ç—É—Å—å–∫–∞</h1>
                    <div class="flex items-center gap-2 text-[10px] text-gray-400 font-mono uppercase tracking-wider">
                        <span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span>
                        –°—Ç–∞—Ç—É—Å: –ö–æ—Ö–∞–Ω–Ω—è 1000% </div>
                </div>
                <div class="bg-white/10 backdrop-blur-md border border-white/10 px-3 py-1.5 rounded-full flex items-center gap-2 shadow-lg">
                    <i class="fas fa-coins text-yellow-400 text-sm"></i>
                    <span id="coinBalance" class="font-bold text-sm">500</span>
                </div>
            </div>
        </header>

        <main id="mainContent" class="flex-1 overflow-y-auto scroll-hidden px-4 pt-24 pb-24 w-full text-center">
            </main>

        <nav class="fixed bottom-0 left-0 right-0 glass border-t border-white/5 safe-bottom z-40 w-full">
            <div class="h-16 flex justify-around items-center px-2">
                <button onclick="router('home')" id="nav-home" class="nav-btn text-gray-500 w-16 h-full flex flex-col items-center justify-center gap-1 transition-all duration-300">
                    <i class="fas fa-heart text-xl mb-0.5"></i>
                    <span class="text-[10px] font-medium">–ì–æ–ª–æ–≤–Ω–∞</span>
                </button>
                <button onclick="router('store')" id="nav-store" class="nav-btn text-gray-500 w-16 h-full flex flex-col items-center justify-center gap-1 transition-all duration-300">
                    <i class="fas fa-store text-xl mb-0.5"></i>
                    <span class="text-[10px] font-medium">–ú–∞–≥–∞–∑–∏–Ω</span>
                </button>
                <button onclick="router('letters')" id="nav-letters" class="nav-btn text-gray-500 w-16 h-full flex flex-col items-center justify-center gap-1 transition-all duration-300">
                    <i class="fas fa-envelope-open-text text-xl mb-0.5"></i>
                    <span class="text-[10px] font-medium">–õ–∏—Å—Ç–∏</span>
                </button>
            </div>
        </nav>

    </div>

    <div id="buyModal" class="hidden fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 w-full h-full">
        <div class="glass-card w-full max-w-sm p-6 text-center transform transition-all scale-100 mx-auto">
            <div class="w-16 h-16 rounded-full bg-primary/20 flex items-center justify-center mx-auto mb-4 border border-primary/30">
                <i class="fas fa-heart text-3xl text-primary drop-shadow-[0_0_10px_rgba(255,105,180,0.8)]"></i>
            </div>
            <h3 class="text-xl font-bold mb-2">–ö—É–ø—É—î–º–æ?</h3>
            <p class="text-gray-300 mb-8 text-sm leading-relaxed">–¶–µ –±–∞–∂–∞–Ω–Ω—è –∫–æ—à—Ç—É—î <span id="modalPrice" class="font-bold text-white"></span> –º–æ–Ω–µ—Ç.</p>
            <div class="flex gap-3">
                <button onclick="closeModal('buyModal')" class="flex-1 py-3.5 rounded-xl bg-white/5 hover:bg-white/10 text-gray-300 font-medium transition-colors">–ù—ñ</button>
                <button onclick="confirmPurchase()" class="flex-1 py-3.5 rounded-xl bg-primary text-white font-bold shadow-lg shadow-primary/40 active:scale-95 transition-transform">–¢–∞–∫, –±–µ—Ä—É! ‚ù§Ô∏è</button>
            </div>
        </div>
    </div>

    <div id="ticketModal" class="hidden fixed inset-0 z-[70] bg-[#1a0f1f] flex flex-col items-center justify-center p-4 w-full h-full">
        <div class="w-full max-w-sm relative mx-auto">
            <div class="bg-white text-bg rounded-3xl overflow-hidden shadow-2xl relative">
                <div class="bg-primary p-4 text-center">
                    <h3 class="text-white font-black text-lg tracking-widest uppercase">–ö–≤–∏—Ç–æ–∫ –ë–∞–∂–∞–Ω–Ω—è</h3> </div>
                <div class="p-8 flex flex-col items-center relative">
                    <div class="absolute -left-4 top-1/2 w-8 h-8 bg-[#1a0f1f] rounded-full"></div>
                    <div class="absolute -right-4 top-1/2 w-8 h-8 bg-[#1a0f1f] rounded-full"></div>
                    <div class="absolute left-4 right-4 top-1/2 border-t-2 border-dashed border-gray-300"></div>

                    <h2 id="ticketTitle" class="text-2xl font-black text-center mb-1 uppercase text-gray-800 z-10 bg-white px-2">–ü–æ—Å–ª—É–≥–∞</h2>
                    <p class="text-gray-400 text-[10px] font-mono mb-6 tracking-wide uppercase">–û–¥–Ω–æ—Ä–∞–∑–æ–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è</p> <div class="w-40 h-40 bg-gray-900 p-3 rounded-xl mb-4 shadow-inner">
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=LoveVituska" class="w-full h-full object-cover opacity-90 rounded-lg">
                    </div>
                    
                    <p class="text-xs text-gray-400 font-mono mt-2">ID: <span id="ticketId" class="text-primary font-bold">LOVE-001</span></p>
                </div>
                <div class="p-4 bg-gray-50 border-t border-gray-100">
                     <a id="emailLink" href="#" class="block w-full text-center py-3.5 rounded-xl bg-gray-900 text-white font-bold hover:bg-black transition-colors shadow-lg">
                        <i class="fas fa-paper-plane mr-2 text-primary"></i> –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ü–ª–ª—ñ
                    </a>
                </div>
            </div>
            
            <button onclick="closeModal('ticketModal')" class="block w-full text-center mt-6 text-gray-500 hover:text-white transition-colors text-sm">
                –ó–∞–∫—Ä–∏—Ç–∏
            </button>
        </div>
    </div>

    <div id="letterModal" class="hidden fixed inset-0 z-[80] bg-[#1a0f1f]/95 backdrop-blur-xl flex flex-col w-full h-full">
        <div class="safe-top flex items-center justify-between px-6 py-4 w-full">
            <button onclick="closeModal('letterModal')" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center text-white active:scale-90 transition-transform">
                <i class="fas fa-arrow-left"></i>
            </button>
            <span class="font-bold text-gray-300 tracking-widest text-xs uppercase">–û—Å–æ–±–ª–∏–≤–∏–π –ª–∏—Å—Ç</span> <div class="w-10"></div>
        </div>
        
        <div id="letterContent" class="flex-1 p-8 overflow-y-auto pb-20 flex flex-col items-center w-full">
            </div>
    </div>

    <script>
        const CONFIG = {
            startDate: new Date("2020-11-10T00:00:00"),
            passcode: "10112020",
            email: "illia.nazarivskyi.crowner@gmail.com"
        };

        const ITEMS = [
            { id: 1, title: "–ö–∞–≤–∞/–ß–∞–π", price: 20, icon: "‚òï" },
            { id: 2, title: "–ü–æ—Ü—ñ–ª—É–Ω–æ–∫", price: 30, icon: "üíã" },
            { id: 3, title: "–û–±—ñ–π–º–∏ (10 —Ö–≤)", price: 40, icon: "ü§ó" },
            { id: 4, title: "–ú–∞—Å–∞–∂ –Ω—ñ–≥", price: 50, icon: "ü¶∂" },
            { id: 5, title: "–ú–∞—Å–∞–∂ —Å–ø–∏–Ω–∏", price: 70, icon: "üíÜ‚Äç‚ôÄÔ∏è" },
            { id: 6, title: "–°–Ω—ñ–¥–∞–Ω–æ–∫ —É –ª—ñ–∂–∫–æ", price: 80, icon: "ü•û" },
            { id: 7, title: "–í–µ—á–µ—Ä—è –≤—ñ–¥ –Ü–ª–ª—ñ", price: 90, icon: "üçù" },
            { id: 8, title: "–ö—ñ–Ω–æ (—Ç–≤—ñ–π –≤–∏–±—ñ—Ä)", price: 110, icon: "üé¨" },
            { id: 9, title: "–î–∂–æ–∫–µ—Ä (Win)", price: 200, icon: "üÉè", weekly: true }
        ];

        const LETTERS = [
            { id: 'sad', title: "–ö–æ–ª–∏ —Ç–æ–±—ñ —Å—É–º–Ω–æ", icon: "üò¢", content: `<p class="mb-6 text-lg text-gray-200">–ú–æ—è —Ä—ñ–¥–Ω–∞, –ø–∞–º'—è—Ç–∞–π: –∂–æ–¥–µ–Ω –¥–æ—â –Ω–µ –π–¥–µ –≤—ñ—á–Ω–æ. –Ø –ø–æ—Ä—É—á, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —Ñ—ñ–∑–∏—á–Ω–æ –¥–∞–ª–µ–∫–æ.</p><img src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExajZ4ZnV4ZnV4ZnV4ZnV4ZnV4ZnV4ZnV4ZnV4ZnV4ZnV4ZnV4ZnV4ZiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3oEdv4hwTZKSjEBsWS/giphy.gif" class="rounded-2xl shadow-2xl w-full mb-6 border border-white/10"><p class="text-gray-300">–¢–∏ ‚Äî –º–æ—î —Å–æ–Ω—Ü–µ. –í–∏—Ç—Ä–∏ —Å–ª—ñ–∑–∫–∏, –±–æ –≤–æ–Ω–∏ –∑–∞–Ω–∞–¥—Ç–æ –¥–æ—Ä–æ–≥—ñ.</p>` },
            { id: 'miss', title: "–ö–æ–ª–∏ —Å—É–º—É—î—à", icon: "ü•∫", content: `<p class="mb-6 text-lg">–Ø —Ç–µ–∂ –∑–∞ —Ç–æ–±–æ—é —Å—É–º—É—é. –ö–æ–∂–Ω—É —Å–µ–∫—É–Ω–¥—É.</p><p class="text-gray-300 mb-6">–ó–∞–∫—Ä–∏–π –æ—á—ñ —ñ —É—è–≤–∏, —â–æ —è —Ç–µ–±–µ –º—ñ—Ü–Ω–æ –æ–±—ñ–π–º–∞—é.</p><img src="https://media.giphy.com/media/l4pTdcifPZLpDjL1e/giphy.gif" class="rounded-2xl shadow-2xl w-full border border-white/10">` },
            { id: 'mad', title: "–ö–æ–ª–∏ –∑–ª–∏—à—Å—è", icon: "üò°", content: `<p class="mb-6 text-lg">–Ø –∑–Ω–∞—é, —â–æ —è —ñ–Ω–æ–¥—ñ –±—É–≤–∞—é –Ω–µ—Å—Ç–µ—Ä–ø–Ω–∏–º. –ü—Ä–æ–±–∞—á –º–µ–Ω—ñ, –±—É–¥—å –ª–∞—Å–∫–∞.</p><p>–î–∞–≤–∞–π –Ω–µ –±—É–¥–µ–º–æ –≤–∏—Ç—Ä–∞—á–∞—Ç–∏ —á–∞—Å –Ω–∞ —Å–≤–∞—Ä–∫–∏? –õ—é–±–ª—é —Ç–µ–±–µ!</p>` },
            { id: 'sleep', title: "–ù–µ –º–æ–∂–µ—à —Å–ø–∞—Ç–∏", icon: "üò¥", content: `<p class="mb-6 text-lg">–°–ø—Ä–æ–±—É–π –ø–æ—Ä–∞—Ö—É–≤–∞—Ç–∏ –Ω–µ –æ–≤–µ—Ü—å, –∞ –Ω–∞—à—ñ –ø–æ—Ü—ñ–ª—É–Ω–∫–∏. –á—Ö –±—É–ª–æ –º—ñ–ª—å–π–æ–Ω–∏.</p><iframe class="w-full aspect-video rounded-2xl mb-6 shadow-2xl border border-white/10" src="https://www.youtube.com/embed/jfKfPfyJRdk" frameborder="0" allowfullscreen></iframe>` },
            { id: 'now', title: "–í–Ü–î–ö–†–ò–ô –ó–ê–†–ê–ó", icon: "üíñ", content: `<h2 class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-primary to-purple-400 mb-6 animate-pulse">–ó –î–Ω–µ–º –°–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞!</h2><p class="mb-6 text-lg leading-relaxed">–¢–∏ ‚Äî –Ω–∞–π–∫—Ä–∞—â–µ, —â–æ —Ç—Ä–∞–ø–ª—è–ª–æ—Å—è –≤ –º–æ—î–º—É –∂–∏—Ç—Ç—ñ. –î—è–∫—É–ª—é —Ç–æ–±—ñ –∑–∞ —Ç–µ, —â–æ —Ç–∏ —î.</p><p class="text-gray-300">–£ –Ω–µ–¥—ñ–ª—é –±—É–¥–µ –Ω–∞—à–µ —Å–ø—Ä–∞–≤–∂–Ω—î —Å–≤—è—Ç–æ. –ê –ø–æ–∫–∏ ‚Äî —Ç—Ä–∏–º–∞–π —Ü–µ–π —Ü–∏—Ñ—Ä–æ–≤–∏–π –≤—Å–µ—Å–≤—ñ—Ç.</p>` },
            { id: 'proud', title: "–ö–æ–ª–∏ –≥–æ—Ä–¥–∞", icon: "üèÜ", content: `<p class="text-xl font-bold text-center">–¢–∏ ‚Äî —Ä–æ–∑—É–º–Ω–∏—á–∫–∞! –Ø –∑–∞–≤–∂–¥–∏ –∑–Ω–∞–≤, —â–æ —Ç–∏ –∑–º–æ–∂–µ—à. –ü–∏—à–∞—é—Å—è —Ç–æ–±–æ—é –±–µ–∑–º–µ–∂–Ω–æ!</p>` },
            { id: 'smile', title: "–•–æ—á–µ—à —É—Å–º—ñ—à–∫—É", icon: "üòä", content: `<p class="text-lg">–ß–æ–º—É —Å–∫–µ–ª–µ—Ç –Ω–µ –ø—ñ—à–æ–≤ –Ω–∞ –¥–∏—Å–∫–æ—Ç–µ–∫—É? –ë–æ –π–æ–º—É –Ω–µ –±—É–ª–æ –∑ –∫–∏–º –ø—ñ—Ç–∏ (–±–∞-–¥—É–º-—Ç—Å)! –ü–æ—Å–º—ñ—Ö–Ω–∏—Å—å, —Ç–æ–±—ñ —Ü–µ —Ç–∞–∫ –ª–∏—á–∏—Ç—å.</p>` },
            { id: 'support', title: "–ü–æ—Ç—Ä—ñ–±–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞", icon: "ü§ó", content: `<p class="text-lg font-medium">–¢–∏ —Å–∏–ª—å–Ω—ñ—à–∞, –Ω—ñ–∂ –¥—É–º–∞—î—à. –£ —Ç–µ–±–µ –≤—Å–µ –≤–∏–π–¥–µ, –∞ —è –ø–æ–¥–∞–≤–∞—Ç–∏–º—É –ø–∞—Ç—Ä–æ–Ω–∏.</p>` },
            { id: 'romantic', title: "–†–æ–º–∞–Ω—Ç–∏–∫–∞", icon: "üåπ", content: `<p class="italic text-xl text-center">"–¢–≤–æ—ó –æ—á—ñ —è–∫ –æ–∫–µ–∞–Ω, –≤ —è–∫–æ–º—É —è —Ö–æ—á—É —Ç–æ–Ω—É—Ç–∏ –≤—ñ—á–Ω–æ..."</p>` },
            { id: 'hungry', title: "–ö–æ–ª–∏ –≥–æ–ª–æ–¥–Ω–∞", icon: "üçì", content: `<p class="text-lg">–¢–µ—Ä–º—ñ–Ω–æ–≤–æ –∑'—ó–∂ —â–æ—Å—å —Å–º–∞—á–Ω–µ–Ω—å–∫–µ! –ê–±–æ –Ω–∞–ø–∏—à–∏ –º–µ–Ω—ñ, —è –∑–∞–º–æ–≤–ª—é –¥–æ—Å—Ç–∞–≤–∫—É.</p>` },
            { id: 'tired', title: "–í—Ç–æ–º–ª–µ–Ω–∞", icon: "üò©", content: `<p class="text-lg">–í—ñ–¥–∫–ª–∞–¥–∏ –≤—Å–µ. –¢–∏ —É —Å–µ–±–µ –æ–¥–Ω–∞. –õ—è–≥–∞–π, –≤—ñ–¥–ø–æ—á–∏–Ω—å, —Å–≤—ñ—Ç –ø–æ—á–µ–∫–∞—î.</p>` },
            { id: 'love', title: "–•–æ—á–µ—à '–õ—é–±–ª—é'", icon: "‚ù§Ô∏è", content: `<h1 class="text-5xl text-center text-primary font-black animate-heartbeat drop-shadow-[0_0_20px_rgba(255,105,180,0.8)]">–Ø –¢–ï–ë–ï –õ–Æ–ë–õ–Æ!</h1>` },
        ];

        let appState = JSON.parse(localStorage.getItem('ourSpaceData')) || {
            coins: 500,
            purchases: [],
            openedLetters: [],
            lastLogin: null
        };
        
        let els = {};

        function init() {
            els = {
                login: document.getElementById('loginScreen'),
                app: document.getElementById('appScreen'),
                passcode: document.getElementById('passcode'),
                content: document.getElementById('mainContent'),
                balance: document.getElementById('coinBalance'),
                error: document.getElementById('errorMsg')
            };

            if (localStorage.getItem('isLoggedIn')) {
                showApp();
            } else {
                els.passcode.addEventListener('input', (e) => {
                    if (e.target.value.length === 8) checkPasscodeManual();
                });
            }

            const today = new Date().toDateString();
            if (localStorage.getItem('isLoggedIn') && appState.lastLogin !== today) {
                appState.coins += 100;
                appState.lastLogin = today;
                saveState();
                setTimeout(() => {
                    if (!els.app.classList.contains('hidden')) {
                        confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } });
                        showToast("–î–æ–±—Ä–æ–≥–æ —Ä–∞–Ω–∫—É! +100 –º–æ–Ω–µ—Ç", "fa-sun");
                    }
                }, 2000);
            }
        }

        function checkPasscodeManual() {
            const val = document.getElementById('passcode').value;
            if (val === CONFIG.passcode) {
                document.getElementById('passcode').blur();
                localStorage.setItem('isLoggedIn', 'true');
                if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
                document.getElementById('loginScreen').classList.add('opacity-0');
                setTimeout(() => {
                    document.getElementById('loginScreen').classList.add('hidden');
                    showApp();
                }, 500);
            } else {
                if (navigator.vibrate) navigator.vibrate(500);
                const input = document.getElementById('passcode');
                const err = document.getElementById('errorMsg');
                input.classList.add('border-red-500', 'border-2');
                err.classList.remove('opacity-0');
                setTimeout(() => {
                    input.classList.remove('border-red-500', 'border-2');
                    input.value = '';
                }, 1000);
            }
        }

        function showApp() {
            els.app.classList.remove('hidden');
            updateBalance();
            router('home');
        }

        function saveState() {
            localStorage.setItem('ourSpaceData', JSON.stringify(appState));
            updateBalance();
        }

        function updateBalance() {
            if(els.balance) els.balance.innerText = appState.coins;
        }

        function router(route) {
            const content = els.content;
            content.innerHTML = '';
            
            // Update Nav State
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('nav-active', 'text-primary'));
            const activeBtn = document.getElementById(`nav-${route}`);
            if(activeBtn) {
                activeBtn.classList.add('nav-active', 'text-primary');
                activeBtn.classList.remove('text-gray-500');
            }

            if (route === 'home') renderHome(content);
            if (route === 'store') renderStore(content);
            if (route === 'letters') renderLetters(content);
        }

        function renderHome(container) {
            // FIX: Removed 100vh requirement, added margin-auto and max-width for centering
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center min-h-[60vh] space-y-10 animate-slide-up w-full max-w-sm mx-auto">
                    <div id="timerContainer" class="text-center relative py-10 active:scale-95 transition-transform w-full" onclick="handleTimerClick()">
                        <div class="text-gray-400 text-[10px] font-bold uppercase tracking-[0.3em] mb-4">–ú–∏ —Ä–∞–∑–æ–º –≤–∂–µ</div>
                        <h2 id="daysCounter" class="text-7xl font-black text-white mb-2 drop-shadow-[0_0_15px_rgba(255,255,255,0.3)] leading-none">0</h2>
                        <span class="text-2xl text-primary font-medium tracking-widest">–¥–Ω—ñ–≤</span>
                        <div class="mt-8 py-2 px-6 bg-white/5 rounded-full border border-white/5 inline-block">
                             <div id="timeCounter" class="text-gray-300 font-mono text-sm tracking-widest">00:00:00</div>
                        </div>
                    </div>
                    
                    <div class="w-full glass-card p-6 border-l-4 border-l-primary relative overflow-hidden">
                        <div class="absolute -right-4 -top-4 text-6xl opacity-5">‚ùù</div>
                        <h3 class="text-sm font-bold mb-2 text-primary uppercase tracking-wide">–¶–∏—Ç–∞—Ç–∞ –¥–Ω—è</h3>
                        <p class="text-md italic text-gray-200 font-serif leading-relaxed">"–Ø –ª—é–±–ª—é —Ç–µ–±–µ –Ω–µ –∑–∞ —Ç–µ, —Ö—Ç–æ —Ç–∏, –∞ –∑–∞ —Ç–µ, —Ö—Ç–æ —è, –∫–æ–ª–∏ —è –∑ —Ç–æ–±–æ—é."</p>
                    </div>
                </div>
            `;
            startTimer();
        }

        function renderStore(container) {
            container.innerHTML = `<h2 class="text-2xl font-bold mb-6 text-white animate-slide-up">–ú–∞–≥–∞–∑–∏–Ω –ë–∞–∂–∞–Ω—å</h2>`;
            
            const grid = document.createElement('div');
            grid.className = 'grid grid-cols-2 gap-4 pb-10 animate-slide-up';
            
            ITEMS.forEach(item => {
                const lastPurchase = appState.purchases.filter(p => p.itemId === item.id).sort((a,b) => b.ts - a.ts)[0];
                let onCooldown = false;
                let timeLeftStr = "";

                if (lastPurchase) {
                    const diff = Date.now() - lastPurchase.ts;
                    const cdTime = (item.weekly ? 7 * 24 : 24) * 60 * 60 * 1000;
                    if (diff < cdTime) {
                        onCooldown = true;
                        const hoursLeft = Math.ceil((cdTime - diff) / (1000 * 60 * 60));
                        timeLeftStr = `${hoursLeft} –≥–æ–¥`;
                    }
                }

                const card = document.createElement('div');
                card.className = `glass-card p-5 flex flex-col items-center text-center min-h-[180px] relative overflow-hidden group ${onCooldown ? 'opacity-50 grayscale' : 'active:scale-95 transition-transform'}`;
                card.onclick = () => !onCooldown && openBuyModal(item);
                
                card.innerHTML = `
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-primary to-transparent opacity-50"></div>
                    <div class="text-5xl mb-4 transform group-hover:scale-110 transition-transform duration-300 drop-shadow-lg">${item.icon}</div>
                    <div class="font-bold text-sm mb-1 leading-tight text-gray-100">${item.title}</div>
                    ${onCooldown 
                        ? `<div class="mt-auto py-1 px-3 bg-red-500/20 text-red-200 rounded-full text-[10px] font-mono">‚è≥ ${timeLeftStr}</div>` 
                        : `<div class="mt-auto text-primary font-bold text-lg bg-primary/10 px-4 py-1 rounded-full border border-primary/20">${item.price}</div>`
                    }
                `;
                grid.appendChild(card);
            });
            
            container.appendChild(grid);
        }

        function renderLetters(container) {
            container.innerHTML = `<h2 class="text-2xl font-bold mb-6 text-white animate-slide-up">–í—ñ–¥–∫—Ä–∏–π, –∫–æ–ª–∏...</h2>`;
            
            const grid = document.createElement('div');
            grid.className = 'grid grid-cols-3 gap-3 pb-10 animate-slide-up';
            
            LETTERS.forEach(letter => {
                const isOpened = appState.openedLetters.includes(letter.id);
                
                const card = document.createElement('div');
                card.className = `glass-card aspect-square flex flex-col items-center justify-center p-2 text-center transition-all duration-300 relative ${isOpened ? 'bg-primary/10 border-primary/30' : 'active:scale-95 hover:bg-white/5'}`;
                card.onclick = () => openLetter(letter);
                
                if (isOpened) {
                    card.innerHTML = `
                        <div class="text-3xl mb-2 animate-float">${letter.icon}</div>
                        <div class="text-[9px] text-primary font-bold leading-tight uppercase tracking-wide px-1">${letter.title}</div>
                    `;
                } else {
                    card.innerHTML = `
                        <i class="fas fa-envelope text-3xl text-gray-500 mb-2"></i>
                        <div class="text-[9px] text-gray-400 leading-tight px-1">${letter.title}</div>
                        <div class="absolute top-2 right-2 w-1.5 h-1.5 bg-primary rounded-full shadow-[0_0_5px_#ff69b4]"></div>
                    `;
                }
                
                grid.appendChild(card);
            });

            container.appendChild(grid);
        }

        let timerInterval;
        let timerClicks = 0;

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            function update() {
                const now = new Date();
                const diff = now - CONFIG.startDate;
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
                const minutes = Math.floor((diff / (1000 * 60)) % 60);
                const seconds = Math.floor((diff / 1000) % 60);
                const dayEl = document.getElementById('daysCounter');
                const timeEl = document.getElementById('timeCounter');
                if (dayEl) dayEl.innerText = days;
                if (timeEl) timeEl.innerText = `${String(hours).padStart(2, '0')} : ${String(minutes).padStart(2, '0')} : ${String(seconds).padStart(2, '0')}`;
            }
            update();
            timerInterval = setInterval(update, 1000);
        }

        function handleTimerClick() {
            timerClicks++;
            if (timerClicks === 10) {
                confetti({
                    particleCount: 200,
                    spread: 100,
                    origin: { y: 0.6 },
                    colors: ['#ff69b4', '#ffffff']
                });
                showToast("–ü–ê–°–•–ê–õ–ö–ê! +50 –º–æ–Ω–µ—Ç!", "fa-gem");
                appState.coins += 50;
                saveState();
                timerClicks = 0;
            }
        }

        let selectedItem = null;

        function openBuyModal(item) {
            if (appState.coins < item.price) {
                showToast("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –º–æ–Ω–µ—Ç ü•∫", "fa-ban");
                return;
            }
            selectedItem = item;
            document.getElementById('modalPrice').innerText = item.price;
            document.getElementById('buyModal').classList.remove('hidden');
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
        }

        function confirmPurchase() {
            if (!selectedItem) return;
            appState.coins -= selectedItem.price;
            appState.purchases.push({ itemId: selectedItem.id, ts: Date.now() });
            saveState();
            closeModal('buyModal');
            
            const ticketModal = document.getElementById('ticketModal');
            document.getElementById('ticketTitle').innerText = selectedItem.title;
            document.getElementById('ticketId').innerText = `LOVE-${Math.floor(Math.random()*10000)}`;
            
            const subject = encodeURIComponent(`OurSpace: –í—ñ—Ç—É—Å—å–∫–∞ –∫—É–ø–∏–ª–∞ ${selectedItem.title}!`);
            const body = encodeURIComponent(`–ü—Ä–∏–≤—ñ—Ç, –Ü–ª–ª—è!\n\n–Ø —â–æ–π–Ω–æ –∫—É–ø–∏–ª–∞ "${selectedItem.title}" –∑–∞ ${selectedItem.price} –º–æ–Ω–µ—Ç.\n\n–ö–æ–ª–∏ –≤–∏–∫–æ–Ω–∞—î—à? ‚ù§Ô∏è`);
            document.getElementById('emailLink').href = `mailto:${CONFIG.email}?subject=${subject}&body=${body}`;
            
            ticketModal.classList.remove('hidden');
            confetti({ particleCount: 150, spread: 60 });
        }

        function openLetter(letter) {
            const modal = document.getElementById('letterModal');
            const content = document.getElementById('letterContent');
            content.innerHTML = `
                <div class="text-center mb-8 animate-slide-up w-full">
                    <div class="text-8xl mb-6 filter drop-shadow-[0_0_20px_rgba(255,105,180,0.5)] animate-float">${letter.icon}</div>
                    <h2 class="text-2xl font-bold text-white uppercase tracking-wider">${letter.title}</h2>
                    <div class="w-16 h-1 bg-primary mx-auto mt-4 rounded-full"></div>
                </div>
                <div class="text-gray-200 leading-loose text-justify w-full animate-slide-up px-2" style="animation-delay: 0.1s">
                    ${letter.content}
                </div>
            `;
            modal.classList.remove('hidden');
            if (!appState.openedLetters.includes(letter.id)) {
                appState.openedLetters.push(letter.id);
                appState.coins += 25;
                saveState();
                setTimeout(() => {
                    confetti({ particleCount: 50, origin: { y: 0.8 } });
                    showToast("+25 –º–æ–Ω–µ—Ç –∑–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è!", "fa-gift");
                }, 1000);
            }
        }

        function showToast(msg, icon = "fa-info-circle") {
            // Remove existing toasts
            const existing = document.querySelector('.toast-notification');
            if(existing) existing.remove();

            const toast = document.createElement('div');
            toast.className = 'toast-notification animate-slide-up';
            toast.innerHTML = `<i class="fas ${icon}"></i> <span>${msg}</span>`;
            
            document.body.appendChild(toast);
            
            // Auto hide
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translate(-50%, 20px)';
                setTimeout(() => toast.remove(), 500);
            }, 3000);
        }

        window.onload = init;
    </script>
</body>
</html>
