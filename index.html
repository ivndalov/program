<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="color-scheme" content="dark">
    <title>OurSpace</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="OurSpace">
    <meta name="theme-color" content="#1a0f1f">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/192/love-circled.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
    tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#1a0f1f',
                        primary: '#ff69b4',
                        secondary: '#8b5cf6',
                        surface: 'rgba(255, 255, 255, 0.1)',
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'heartbeat': 'heartbeat 1.5s ease-in-out infinite',
                        'toast-in': 'toastIn 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'toast-out': 'toastOut 0.5s ease-in forwards',
                        'spin-slow': 'spin 3s linear infinite',
                        'breathe': 'breathe 8s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        heartbeat: {
                            '0%': { transform: 'scale(1)' },
                            '14%': { transform: 'scale(1.1)' },
                            '28%': { transform: 'scale(1)' },
                            '42%': { transform: 'scale(1.1)' },
                            '70%': { transform: 'scale(1)' },
                        },
                        toastIn: {
                            '0%': { opacity: 0, transform: 'translateY(20px)' },
                            '100%': { opacity: 1, transform: 'translateY(0)' },
                        },
                        toastOut: {
                            '0%': { opacity: 1, transform: 'translateY(0)' },
                            '100%': { opacity: 0, transform: 'translateY(-20px)' },
                        },
                        breathe: {
                            '0%, 100%': { transform: 'scale(1)', opacity: '0.3' },
                            '50%': { transform: 'scale(1.5)', opacity: '0.8' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #1a0f1f;
            color: white;
            overscroll-behavior-y: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            height: 100vh;
            overflow: hidden;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }

        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .glass-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.01) 100%);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 20px;
        }

        .neon-text {
            text-shadow: 0 0 10px rgba(255, 105, 180, 0.7), 0 0 20px rgba(255, 105, 180, 0.5);
        }

        .bg-glow {
            position: absolute;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255,105,180,0.4) 0%, rgba(26,15,31,0) 70%);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: -1;
            pointer-events: none;
        }

        .scroll-hidden::-webkit-scrollbar {
            display: none;
        }
        .scroll-hidden {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .page-transition {
            animation: fadeUp 0.4s ease-out forwards;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        .shake { animation: shake 0.5s; }

        input::placeholder { color: rgba(255,255,255,0.3); }
        
        .modal-header {
            padding-top: max(2rem, env(safe-area-inset-top));
        }

        /* Improved Match 3 Grid Styles */
        .match-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
            width: 100%;
            max-width: 320px;
            margin: 0 auto;
            background: rgba(0,0,0,0.3);
            padding: 6px;
            border-radius: 12px;
        }
        .match-cell {
            aspect-ratio: 1;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            box-shadow: inset 0 2px 4px rgba(255,255,255,0.1), 0 2px 4px rgba(0,0,0,0.2);
        }
        .match-cell:active {
            transform: scale(0.9);
        }
        .match-cell.selected {
            background: rgba(255, 105, 180, 0.3);
            border: 2px solid #ff69b4;
            transform: scale(1.05);
            z-index: 10;
        }
        .match-cell.invalid {
            animation: shake 0.3s;
            border: 2px solid red;
        }
        
        /* Custom Range Slider */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #ff69b4;
            cursor: pointer;
            margin-top: -8px;
            box-shadow: 0 0 10px rgba(255,105,180,0.5);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
        }
    </style>
</head>
<body>

    <div class="bg-glow animate-pulse-slow"></div>
    <div id="particles"></div>

    <div id="loginScreen" class="fixed inset-0 z-50 flex flex-col items-center justify-center p-6 bg-bg transition-opacity duration-500">
        <div class="text-6xl mb-8 animate-heartbeat">üîí</div>
        <h1 class="text-2xl font-bold mb-2 text-center text-primary neon-text">OurSpace</h1>
        <p class="text-gray-300 mb-8 text-center text-sm">–í–≤–µ–¥—ñ—Ç—å –¥–∞—Ç—É –Ω–∞—à–æ–≥–æ –ø–æ—á–∞—Ç–∫—É</p>
        
        <input type="tel" id="passcode" maxlength="8" placeholder="–î–î–ú–ú–†–†–†–†" 
               class="glass text-center text-2xl tracking-widest text-white rounded-full py-4 px-6 w-64 focus:outline-none focus:border-primary transition-all mb-6">
        
        <button onclick="checkPasscodeManual()" class="bg-primary text-white font-bold py-3 px-8 rounded-full shadow-lg active:scale-95 transition-transform">
            –í—ñ–¥–∫—Ä–∏—Ç–∏ ‚ù§Ô∏è
        </button>
        
        <p id="errorMsg" class="text-red-400 mt-6 text-sm opacity-0 transition-opacity">–°–ø—Ä–æ–±—É–π —â–µ, –º–æ—è –ª—é–±–æ–≤–µ ‚ù§Ô∏è</p>
    </div>

    <div id="appScreen" class="hidden h-full flex flex-col">
        
        <header class="pt-14 pb-4 px-6 flex justify-between items-center glass border-b-0 rounded-b-3xl z-20">
            <div class="flex items-center gap-3">
                <button onclick="openAdminPanel()" class="text-gray-400 hover:text-white transition-colors">
                    <i class="fas fa-cog text-xl"></i>
                </button>
                <div>
                    <h1 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-purple-400">–í—ñ—Ç—É—Å—å–∫–∞</h1>
                    <div class="flex items-center gap-2 text-xs text-gray-300">
                        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                        –ó–≤'—è–∑–æ–∫: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ‚ù§Ô∏è
                    </div>
                </div>
            </div>
            <div class="glass px-3 py-1 rounded-full flex items-center gap-2 bg-white/10">
                <i class="fas fa-coins text-yellow-400"></i>
                <span id="coinBalance" class="font-bold text-white">500</span>
            </div>
        </header>

        <main id="mainContent" class="flex-1 overflow-y-auto scroll-hidden p-6 pb-24 relative page-transition">
            </main>

        <nav class="fixed bottom-6 left-6 right-6 h-20 glass rounded-2xl flex justify-around items-center z-40 shadow-2xl">
            <button onclick="router('home')" id="nav-home" class="nav-btn text-primary transition-colors flex flex-col items-center gap-1 active:scale-90 duration-200">
                <i class="fas fa-heart text-2xl"></i>
                <span class="text-[10px]">–ì–æ–ª–æ–≤–Ω–∞</span>
            </button>
            <button onclick="router('store')" id="nav-store" class="nav-btn text-gray-400 hover:text-primary transition-colors flex flex-col items-center gap-1 active:scale-90 duration-200">
                <i class="fas fa-store text-2xl"></i>
                <span class="text-[10px]">–ú–∞–≥–∞–∑–∏–Ω</span>
            </button>
            <button onclick="router('games')" id="nav-games" class="nav-btn text-gray-400 hover:text-primary transition-colors flex flex-col items-center gap-1 active:scale-90 duration-200">
                <i class="fas fa-gamepad text-2xl"></i>
                <span class="text-[10px]">–Ü–≥—Ä–∏</span>
            </button>
        </nav>
    </div>

    <div id="buyModal" class="hidden fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 page-transition">
        <div class="glass-card w-full max-w-sm p-6 text-center">
            <div class="w-16 h-16 rounded-full bg-primary/20 flex items-center justify-center mx-auto mb-4">
                <i class="fas fa-question text-3xl text-primary"></i>
            </div>
            <h3 class="text-xl font-bold mb-2">–ö—É–ø—É—î–º–æ?</h3>
            <p class="text-gray-300 mb-6 text-sm">–¶–µ –∫–æ—à—Ç—É–≤–∞—Ç–∏–º–µ <span id="modalPrice" class="font-bold text-primary"></span> –º–æ–Ω–µ—Ç.</p>
            
            <div id="quantityControl" class="hidden mb-6">
                <div class="flex justify-between text-sm text-gray-400 mb-2">
                    <span>–ö—ñ–ª—å–∫—ñ—Å—Ç—å:</span>
                    <span id="quantityValue" class="text-white font-bold">1</span>
                </div>
                <input type="range" id="quantityRange" min="1" max="10" value="1" class="w-full">
            </div>

            <div class="flex gap-4">
                <button onclick="closeModal('buyModal')" class="flex-1 py-3 rounded-xl bg-gray-700 text-white font-medium hover:bg-gray-600">–ù—ñ</button>
                <button onclick="confirmPurchase()" class="flex-1 py-3 rounded-xl bg-gradient-to-r from-primary to-purple-600 text-white font-bold shadow-lg shadow-primary/30">–¢–∞–∫ ‚ù§Ô∏è</button>
            </div>
        </div>
    </div>

    <div id="ticketModal" class="hidden fixed inset-0 z-[70] bg-black/90 backdrop-blur-md flex items-center justify-center p-4 page-transition">
        <div class="glass-card w-full max-w-sm p-0 overflow-hidden relative">
            <div class="bg-gradient-to-r from-primary to-purple-600 p-4 text-center">
                <h3 class="text-white font-bold text-lg tracking-widest">OURSPACE TICKET</h3>
            </div>
            <div class="p-8 flex flex-col items-center border-b border-dashed border-gray-500 relative bg-white/5">
                <div class="absolute -left-3 top-1/2 w-6 h-6 bg-[#1a0f1f] rounded-full"></div>
                <div class="absolute -right-3 top-1/2 w-6 h-6 bg-[#1a0f1f] rounded-full"></div>
                
                <h2 id="ticketTitle" class="text-2xl font-bold text-center mb-2 neon-text">–ú–∞—Å–∞–∂</h2>
                <p id="ticketQty" class="text-primary text-sm font-bold mb-1"></p>
                <p class="text-gray-400 text-xs mb-4">–î–Ü–ô–°–ù–ò–ô –ü–†–û–¢–Ø–ì–û–ú 24 –ì–û–î–ò–ù</p>
                <div class="w-32 h-32 bg-white p-2 rounded-lg mb-4">
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=LoveForVituska" class="w-full h-full object-cover opacity-90">
                </div>
                <p class="text-xs text-gray-500 font-mono">ID: <span id="ticketId">LOVE-001</span></p>
            </div>
            <div class="p-4">
                 <a id="emailLink" href="#" class="block w-full text-center py-3 rounded-xl bg-white text-bg font-bold hover:bg-gray-200 transition-colors">
                    <i class="fas fa-paper-plane mr-2"></i> –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ü–ª–ª—ñ
                </a>
                <button onclick="closeModal('ticketModal')" class="block w-full text-center mt-3 text-sm text-gray-400 hover:text-white">–ó–∞–∫—Ä–∏—Ç–∏</button>
            </div>
        </div>
    </div>

    <div id="adminModal" class="hidden fixed inset-0 z-[80] bg-black/95 backdrop-blur-xl flex items-center justify-center p-6 page-transition">
        <div class="glass-card w-full max-w-sm p-6">
            <h3 class="text-xl font-bold mb-4 text-center">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞</h3>
            
            <div id="adminAuth">
                <p class="text-sm text-gray-400 mb-2">–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å:</p>
                <input type="password" id="adminPass" class="w-full bg-white/10 rounded-lg p-3 text-white mb-4 border border-white/20 focus:border-primary outline-none">
                <button onclick="checkAdminPass()" class="w-full bg-gray-700 py-2 rounded-lg font-bold">–£–≤—ñ–π—Ç–∏</button>
            </div>

            <div id="adminControls" class="hidden">
                <p class="text-sm text-gray-400 mb-2">–ë–∞–ª–∞–Ω—Å –º–æ–Ω–µ—Ç:</p>
                <input type="number" id="newCoinBalance" class="w-full bg-white/10 rounded-lg p-3 text-white mb-4 border border-white/20">
                <button onclick="saveAdminChanges()" class="w-full bg-green-600 py-3 rounded-lg font-bold mb-2">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
            </div>
            
            <button onclick="closeModal('adminModal')" class="w-full mt-4 text-sm text-gray-500">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
    </div>

    <div id="historyModal" class="hidden fixed inset-0 z-[80] bg-black/95 backdrop-blur-xl flex items-center justify-center p-6 page-transition">
        <div class="glass-card w-full max-w-sm p-6">
            <h3 class="text-xl font-bold mb-4 text-center text-primary">–ú–æ—ó –†–µ–∫–æ—Ä–¥–∏ üèÜ</h3>
            
            <div id="historyList" class="space-y-2 mb-6 max-h-60 overflow-y-auto scroll-hidden">
                </div>
            
            <button onclick="closeModal('historyModal')" class="w-full mt-2 text-sm text-gray-500">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
    </div>

    <div id="match3Modal" class="hidden fixed inset-0 z-[70] bg-[#1a0f1f] flex flex-col items-center justify-center p-4">
        <div class="glass-card w-full max-w-sm p-6 text-center">
            <div class="flex justify-between items-center mb-4">
                <div class="text-left">
                    <h3 class="text-xl font-bold text-primary">3 –≤ —Ä—è–¥</h3>
                    <div class="text-xs text-gray-400">–ß–∞—Å: <span id="gameTimer" class="text-white font-bold">60</span>—Å</div>
                </div>
                <div class="text-right">
                    <div class="text-white text-xs text-gray-400">–†–µ–∫–æ—Ä–¥: <span id="highScoreDisplay" class="text-primary font-bold">0</span></div>
                    <div class="text-white text-lg font-bold">üèÜ <span id="matchScore">0</span></div>
                </div>
            </div>
            
            <div id="gameGrid" class="match-grid mb-4">
                </div>

            <p id="gameStatus" class="text-sm text-gray-400 mb-4 h-6">–ó–Ω–∞–π–¥–∏ –ø–∞—Ä—É...</p>
            <button onclick="closeMatch3()" class="text-gray-500 text-sm">–í–∏–π—Ç–∏</button>
        </div>
    </div>

    <div id="magicBallModal" class="hidden fixed inset-0 z-[70] bg-black/90 flex flex-col items-center justify-center p-6 text-center">
        <div class="w-64 h-64 rounded-full bg-gradient-to-br from-purple-900 to-black border-4 border-gray-800 flex items-center justify-center shadow-[0_0_50px_rgba(139,92,246,0.5)] mb-8" id="magicBall">
            <div class="w-32 h-32 rounded-full bg-indigo-900/50 flex items-center justify-center text-center p-4">
                <p id="magicAnswer" class="text-gray-400 text-xs font-bold uppercase tracking-widest">–ó–∞–¥–∞–π –ø–∏—Ç–∞–Ω–Ω—è</p>
            </div>
        </div>
        <button onclick="shakeBall()" class="bg-secondary text-white font-bold py-3 px-10 rounded-full shadow-lg active:scale-95 transition-transform">
            –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å
        </button>
        <button onclick="closeModal('magicBallModal')" class="mt-8 text-gray-500">–ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>

    <div id="breatheModal" class="hidden fixed inset-0 z-[70] bg-[#1a0f1f] flex flex-col items-center justify-center">
        <div class="relative w-64 h-64 flex items-center justify-center">
            <div class="absolute inset-0 bg-primary/20 rounded-full animate-breathe blur-xl"></div>
            <div class="absolute inset-4 bg-primary/40 rounded-full animate-breathe blur-md" style="animation-delay: 0.1s"></div>
            <div class="relative z-10 text-center">
                <h2 class="text-2xl font-bold text-white mb-2">–î–∏—Ö–∞–π</h2>
                <p class="text-xs text-primary/80">–í–¥–∏—Ö... –í–∏–¥–∏—Ö...</p>
            </div>
        </div>
        <p class="mt-12 text-gray-400 text-sm max-w-xs text-center px-6">"–Ø –ø–æ—Ä—É—á. –í—Å–µ –¥–æ–±—Ä–µ. –¢–∏ –≤ –±–µ–∑–ø–µ—Ü—ñ."</p>
        <button onclick="closeModal('breatheModal')" class="absolute bottom-10 text-gray-500">–ó–∞–≤–µ—Ä—à–∏—Ç–∏</button>
    </div>

    <script>
        const CONFIG = {
            startDate: new Date("2020-11-10T00:00:00"),
            passcode: "10112020",
            email: "illia.nazarivskyi.crowner@gmail.com",
            adminPass: "admin"
        };

        // LOYAL COOLDOWNS (Minutes)
        const ITEMS = [
            { id: 1, title: "–ö–∞–≤–∞/–ß–∞–π", price: 20, icon: "‚òï", cooldownMinutes: 40 }, 
            { id: 2, title: "–ü–æ—Ü—ñ–ª—É–Ω–æ–∫", price: 30, icon: "üíã", cooldownMinutes: 10, multiple: true }, 
            { id: 3, title: "–û–±—ñ–π–º–∏ (10 —Ö–≤)", price: 40, icon: "ü§ó", cooldownMinutes: 120 },
            { id: 4, title: "–ú–∞—Å–∞–∂ –Ω—ñ–≥", price: 50, icon: "ü¶∂", cooldownMinutes: 1440 },
            { id: 5, title: "–ú–∞—Å–∞–∂ —Å–ø–∏–Ω–∏", price: 70, icon: "üíÜ‚Äç‚ôÄÔ∏è", cooldownMinutes: 1440 },
            { id: 6, title: "–°–Ω—ñ–¥–∞–Ω–æ–∫ —É –ª—ñ–∂–∫–æ", price: 80, icon: "ü•û", cooldownMinutes: 720 },
            { id: 7, title: "–í–µ—á–µ—Ä—è –≤—ñ–¥ –Ü–ª–ª—ñ", price: 90, icon: "üçù", cooldownMinutes: 720 },
            { id: 8, title: "–ö—ñ–Ω–æ (—Ç–≤—ñ–π –≤–∏–±—ñ—Ä)", price: 110, icon: "üé¨", cooldownMinutes: 1440 },
            { id: 9, title: "–î–∂–æ–∫–µ—Ä (Win)", price: 200, icon: "üÉè", cooldownMinutes: 10080 }
        ];

        const QUOTES_DB = [
            "–Ø –ª—é–±–ª—é —Ç–µ–±–µ –Ω–µ –∑–∞ —Ç–µ, —Ö—Ç–æ —Ç–∏, –∞ –∑–∞ —Ç–µ, —Ö—Ç–æ —è, –∫–æ–ª–∏ —è –∑ —Ç–æ–±–æ—é.",
            "–¢–∏ ‚Äî –º–æ—è –Ω–∞–π—É–ª—é–±–ª–µ–Ω—ñ—à–∞ –ø—Ä–∏—á–∏–Ω–∞ –Ω–µ —Å–ø–∞—Ç–∏ –≤–Ω–æ—á—ñ.",
            "–ö–æ–ª–∏ —è –¥–∏–≤–ª—é—Å—å –Ω–∞ —Ç–µ–±–µ, —è –±–∞—á—É –≤–µ—Å—å —Å–≤—ñ—Ç –≤ —Ç–≤–æ—ó—Ö –æ—á–∞—Ö.",
            "–¢–≤–æ—è –ø–æ—Å–º—ñ—à–∫–∞ ‚Äî —Ü–µ –≤—Å–µ, —â–æ –º–µ–Ω—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è —â–∞—Å—Ç—è.",
            "–ó —Ç–æ–±–æ—é –∫–æ–∂–Ω–∞ –º–∏—Ç—å –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–∞ –∫–∞–∑–∫—É.",
            "–¢–∏ ‚Äî –º—ñ–π –¥—ñ–º, –¥–µ –± –º–∏ –Ω–µ –±—É–ª–∏.",
            "–ú–æ—î —Å–µ—Ä—Ü–µ –±'—î—Ç—å—Å—è –≤ —Ä–∏—Ç–º—ñ —Ç–≤–æ–≥–æ —ñ–º–µ–Ω—ñ.",
            "–¢–∏ —Ä–æ–±–∏—à –º–µ–Ω–µ –∫—Ä–∞—â–∏–º –∫–æ–∂–Ω–æ–≥–æ –¥–Ω—è.",
            "–Ø –æ–±–∏—Ä–∞—é —Ç–µ–±–µ. –Ü –±—É–¥—É –æ–±–∏—Ä–∞—Ç–∏ —Ç–µ–±–µ –∑–Ω–æ–≤—É —ñ –∑–Ω–æ–≤—É.",
            "–¢–≤–æ—ó –æ–±—ñ–π–º–∏ ‚Äî —Ü–µ –º–æ—î –Ω–∞–π–±–µ–∑–ø–µ—á–Ω—ñ—à–µ –º—ñ—Å—Ü–µ.",
            "–ö–æ—Ö–∞–Ω–Ω—è ‚Äî —Ü–µ –∫–æ–ª–∏ —Ç–≤–æ—î —â–∞—Å—Ç—è –≤–∞–∂–ª–∏–≤—ñ—à–µ –∑–∞ –º–æ—î.",
            "–¢–∏ ‚Äî –Ω–∞–π–∫—Ä–∞—â–∞ –ø—Ä–∏–≥–æ–¥–∞ –º–æ–≥–æ –∂–∏—Ç—Ç—è.",
            "–Ø —Ö–æ—á—É —Ç—Ä–∏–º–∞—Ç–∏ —Ç–≤–æ—é —Ä—É–∫—É, –∫–æ–ª–∏ –º–µ–Ω—ñ –±—É–¥–µ 80.",
            "–¢–∏ ‚Äî –º–æ—è –≤–∏–ø–∞–¥–∫–æ–≤—ñ—Å—Ç—å, –Ω–∞ —è–∫—É —è —á–µ–∫–∞–≤ –≤—Å–µ –∂–∏—Ç—Ç—è."
        ];

        let appState = JSON.parse(localStorage.getItem('ourSpaceData')) || {
            coins: 500,
            purchases: [],
            easterEggClaimed: false,
            lastLogin: null,
            highScore: 0,
            gameHistory: [] // [{score: 500, date: "12.02.2024"}]
        };
        
        let els = {};
        let currentRoute = 'home';
        let purchaseQty = 1;

        function init() {
            els = {
                login: document.getElementById('loginScreen'),
                app: document.getElementById('appScreen'),
                passcode: document.getElementById('passcode'),
                content: document.getElementById('mainContent'),
                balance: document.getElementById('coinBalance'),
                error: document.getElementById('errorMsg')
            };

            if (localStorage.getItem('isLoggedIn')) {
                showApp();
            } else {
                els.passcode.addEventListener('input', (e) => {
                    if (e.target.value.length === 8) checkPasscodeManual();
                });
            }

            const today = new Date().toDateString();
            if (localStorage.getItem('isLoggedIn') && appState.lastLogin !== today) {
                appState.coins += 100;
                appState.lastLogin = today;
                saveState();
                setTimeout(() => {
                    if (!els.app.classList.contains('hidden')) {
                        confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                        showToast("–î–æ–±—Ä–æ–≥–æ —Ä–∞–Ω–∫—É! +100 –º–æ–Ω–µ—Ç ‚ù§Ô∏è");
                    }
                }, 2000);
            }
        }

        function checkPasscodeManual() {
            const val = document.getElementById('passcode').value;
            if (val === CONFIG.passcode) {
                document.getElementById('passcode').blur();
                localStorage.setItem('isLoggedIn', 'true');
                if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
                document.getElementById('loginScreen').classList.add('opacity-0');
                setTimeout(() => {
                    document.getElementById('loginScreen').classList.add('hidden');
                    showApp();
                }, 500);
            } else {
                if (navigator.vibrate) navigator.vibrate(500);
                const input = document.getElementById('passcode');
                const err = document.getElementById('errorMsg');
                input.classList.add('shake', 'border-red-500', 'border-2');
                err.classList.remove('opacity-0');
                setTimeout(() => {
                    input.classList.remove('shake', 'border-red-500', 'border-2');
                    input.value = '';
                }, 1000);
            }
        }

        function showApp() {
            els.app.classList.remove('hidden');
            updateBalance();
            router('home');
        }

        function saveState() {
            localStorage.setItem('ourSpaceData', JSON.stringify(appState));
            updateBalance();
        }

        function updateBalance() {
            if(els.balance) els.balance.innerText = appState.coins;
        }

        function router(route) {
            currentRoute = route;
            const content = els.content;
            content.innerHTML = '';
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-primary');
                btn.classList.add('text-gray-400');
            });
            document.getElementById(`nav-${route}`).classList.add('text-primary');
            document.getElementById(`nav-${route}`).classList.remove('text-gray-400');

            if (route === 'home') renderHome(content);
            if (route === 'store') renderStore(content);
            if (route === 'games') renderGames(content);
        }

        function getDailyQuote() {
            const start = new Date(new Date().getFullYear(), 0, 0);
            const diff = new Date() - start;
            const oneDay = 1000 * 60 * 60 * 24;
            const dayOfYear = Math.floor(diff / oneDay);
            return QUOTES_DB[dayOfYear % QUOTES_DB.length];
        }

        function renderHome(container) {
            const dailyQuote = getDailyQuote();

            container.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full w-full max-w-sm mx-auto pb-24 space-y-16 page-transition">
                    
                    <div id="timerContainer" class="text-center relative py-2 active:scale-95 transition-transform w-full" onclick="handleTimerClick()">
                        <div class="text-gray-400 text-[10px] font-bold uppercase tracking-[0.3em] mb-4">–ú–∏ —Ä–∞–∑–æ–º –≤–∂–µ</div>
                        
                        <div class="flex flex-col items-center justify-center">
                            <h2 id="daysCounter" class="text-7xl font-black text-white drop-shadow-[0_0_15px_rgba(255,255,255,0.3)] leading-none">0</h2>
                            <span class="text-2xl text-primary font-medium tracking-widest my-2">–¥–Ω—ñ–≤</span>
                            <div class="mt-2 py-2 px-6 bg-white/5 rounded-full border border-white/5 inline-block">
                                <div id="timeCounter" class="text-gray-300 font-mono text-sm tracking-widest">00:00:00</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="w-full glass-card p-6 border-l-4 border-l-primary relative overflow-hidden text-left">
                        <div class="absolute -right-4 -top-4 text-6xl opacity-5">‚ùù</div>
                        <h3 class="text-sm font-bold mb-2 text-primary uppercase tracking-wide">–¶–∏—Ç–∞—Ç–∞ –¥–Ω—è</h3>
                        <p class="text-md italic text-gray-200 font-serif leading-relaxed">"${dailyQuote}"</p>
                    </div>
                </div>
            `;
            startTimer();
        }

        function renderStore(container) {
            const grid = document.createElement('div');
            grid.className = 'grid grid-cols-2 gap-4 page-transition';
            
            ITEMS.forEach(item => {
                const lastPurchase = appState.purchases.filter(p => p.itemId === item.id).sort((a,b) => b.ts - a.ts)[0];
                let onCooldown = false;
                let timeLeftStr = "";

                if (lastPurchase) {
                    const diff = Date.now() - lastPurchase.ts;
                    const cdTime = item.cooldownMinutes * 60 * 1000;
                    
                    if (diff < cdTime) {
                        onCooldown = true;
                        const minsLeft = Math.ceil((cdTime - diff) / (1000 * 60));
                        if(minsLeft > 60) {
                             timeLeftStr = `${Math.ceil(minsLeft/60)} –≥–æ–¥`;
                        } else {
                             timeLeftStr = `${minsLeft} —Ö–≤`;
                        }
                    }
                }

                const card = document.createElement('div');
                card.className = `glass-card p-4 flex flex-col items-center justify-between text-center min-h-[160px] ${onCooldown ? 'opacity-50 grayscale cursor-not-allowed' : 'active:scale-95 transition-transform cursor-pointer'}`;
                card.onclick = () => !onCooldown && openBuyModal(item);
                
                card.innerHTML = `
                    <div class="text-4xl mb-2">${item.icon}</div>
                    <div class="font-bold text-sm mb-1 leading-tight">${item.title}</div>
                    ${onCooldown 
                        ? `<div class="text-xs text-red-300 font-mono mt-2 bg-red-900/30 px-2 py-1 rounded">‚è≥ –ó–∞–º–æ–≤–ª–µ–Ω–æ (${timeLeftStr})</div>` 
                        : `<div class="text-primary font-bold mt-auto border border-primary/30 px-3 py-1 rounded-full text-xs">${item.price} ü™ô</div>`
                    }
                `;
                grid.appendChild(card);
            });
            
            container.innerHTML = `<h2 class="text-xl font-bold mb-4 pl-2 text-center w-full">–ú–∞–≥–∞–∑–∏–Ω –ë–∞–∂–∞–Ω—å</h2>`;
            container.appendChild(grid);
        }

        function renderGames(container) {
            container.innerHTML = `
                <div class="flex flex-col space-y-4 page-transition pb-24">
                    <h2 class="text-xl font-bold mb-2 pl-2 text-center">–†–æ–∑–≤–∞–≥–∏</h2>

                    <div class="glass-card p-4 flex items-center justify-between active:scale-95 transition-transform">
                        <div class="flex items-center gap-4 cursor-pointer" onclick="startMatch3Init()">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-tr from-pink-500 to-yellow-500 flex items-center justify-center text-2xl">üíé</div>
                            <div class="text-left">
                                <h3 class="font-bold">3 –≤ —Ä—è–¥ (–ê—Ä–∫–∞–¥–∞)</h3>
                                <p class="text-[10px] text-gray-400">–¶—ñ–Ω–∞: 10 ü™ô | 60 —Å–µ–∫—É–Ω–¥</p>
                            </div>
                        </div>
                        <button onclick="showScoreHistory()" class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center text-primary active:scale-90">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>

                    <div class="glass-card p-4 flex items-center justify-between active:scale-95 transition-transform" onclick="openMagicBall()">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-indigo-600 flex items-center justify-center text-2xl">üé±</div>
                            <div class="text-left">
                                <h3 class="font-bold">–ú–∞–≥—ñ—á–Ω–∞ –∫—É–ª—è</h3>
                                <p class="text-[10px] text-gray-400">–î—ñ–∑–Ω–∞–π—Å—è —Å–≤–æ—é –¥–æ–ª—é</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-gray-500"></i>
                    </div>

                    <div class="glass-card p-4 flex items-center justify-between active:scale-95 transition-transform" onclick="openBreathe()">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-teal-500 flex items-center justify-center text-2xl">üßò‚Äç‚ôÄÔ∏è</div>
                            <div class="text-left">
                                <h3 class="font-bold">–î–∏—Ö–∞–Ω–Ω—è –ö–æ—Ö–∞–Ω–Ω—è</h3>
                                <p class="text-[10px] text-gray-400">–¢—É—Ä–±–æ—Ç–∞ —Ç–∞ –î–∑–µ–Ω</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-gray-500"></i>
                    </div>
                </div>
            `;
        }

        // --- IMPROVED MATCH 3 LOGIC (ARCADE MODE) ---
        let board = [];
        let score = 0;
        let selectedCell = null;
        let gameInterval = null;
        let gameTime = 60;
        let isGameActive = false;
        
        const width = 5;
        const candyColors = ['üíé', '‚ù§Ô∏è', 'üçí', 'üåü', 'üçá'];

        function showScoreHistory() {
            const list = document.getElementById('historyList');
            const history = appState.gameHistory || [];
            
            if (history.length === 0) {
                list.innerHTML = `<p class="text-center text-gray-500 text-sm">–©–µ –Ω–µ–º–∞—î —Ä–µ–∫–æ—Ä–¥—ñ–≤ ü•∫</p>`;
            } else {
                list.innerHTML = history.sort((a,b) => b.score - a.score).map((h, i) => `
                    <div class="flex justify-between items-center bg-white/5 p-3 rounded-lg">
                        <div class="flex items-center gap-2">
                            <span class="text-yellow-400 font-bold">${i+1}.</span>
                            <span class="font-bold text-white text-lg">${h.score} üèÜ</span>
                        </div>
                        <span class="text-xs text-gray-400 font-mono">${h.date}</span>
                    </div>
                `).join('');
            }
            document.getElementById('historyModal').classList.remove('hidden');
        }

        function startMatch3Init() {
            if (appState.coins < 10) {
                showToast("–¢—Ä–µ–±–∞ 10 –º–æ–Ω–µ—Ç –¥–ª—è –≥—Ä–∏ ü•∫");
                return;
            }
            appState.coins -= 10;
            saveState();
            updateBalance();
            
            score = 0;
            gameTime = 60;
            isGameActive = true;
            document.getElementById('matchScore').innerText = score;
            document.getElementById('gameTimer').innerText = gameTime;
            document.getElementById('highScoreDisplay').innerText = appState.highScore || 0;
            document.getElementById('gameStatus').innerText = "–ó–±–µ—Ä–∏ —è–∫–æ–º–æ–≥–∞ –±—ñ–ª—å—à–µ!";
            document.getElementById('gameStatus').className = "text-sm text-gray-400 mb-4 h-6";
            
            document.getElementById('match3Modal').classList.remove('hidden');
            createBoard();
            
            // Timer Loop
            if (gameInterval) clearInterval(gameInterval);
            gameInterval = setInterval(() => {
                gameTime--;
                document.getElementById('gameTimer').innerText = gameTime;
                
                if (gameTime <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function endGame() {
            clearInterval(gameInterval);
            isGameActive = false;
            
            // Check win condition
            if (score >= 100) {
                const prize = 50;
                appState.coins += prize;
                document.getElementById('gameStatus').innerText = `–ß–∞—Å –≤–∏–π—à–æ–≤! –í–∏–≥—Ä–∞—à: ${prize} ü™ô`;
                document.getElementById('gameStatus').className = "text-sm text-green-400 font-bold mb-4 h-6 animate-pulse";
                confetti({ particleCount: 200, spread: 80 });
            } else {
                document.getElementById('gameStatus').innerText = "–ß–∞—Å –≤–∏–π—à–æ–≤! –°–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑ ü•∫";
                document.getElementById('gameStatus').className = "text-sm text-red-400 font-bold mb-4 h-6";
            }
            
            // Save Record
            if (score >= 100) {
                if (!appState.gameHistory) appState.gameHistory = [];
                const now = new Date();
                
                // Format: DD.MM HH:MM
                const pad = (n) => n < 10 ? '0' + n : n;
                const dateStr = `${pad(now.getDate())}.${pad(now.getMonth()+1)} ${pad(now.getHours())}:${pad(now.getMinutes())}`;
                
                appState.gameHistory.push({ score: score, date: dateStr });
                
                // Keep top 10
                appState.gameHistory.sort((a,b) => b.score - a.score);
                if (appState.gameHistory.length > 10) appState.gameHistory.pop();
            }

            // Update High Score
            if (score > (appState.highScore || 0)) {
                appState.highScore = score;
            }
            
            saveState();
            updateBalance();
        }

        function closeMatch3() {
            clearInterval(gameInterval);
            isGameActive = false;
            closeModal('match3Modal');
        }

        function createBoard() {
            const grid = document.getElementById('gameGrid');
            grid.innerHTML = '';
            board = [];
            
            for (let i = 0; i < width * width; i++) {
                const candy = document.createElement('div');
                candy.setAttribute('id', i);
                
                let randomColor = candyColors[Math.floor(Math.random() * candyColors.length)];
                while (
                    (i >= 2 && board[i-1].innerText === randomColor && board[i-2].innerText === randomColor) ||
                    (i >= 10 && board[i-5].innerText === randomColor && board[i-10].innerText === randomColor)
                ) {
                    randomColor = candyColors[Math.floor(Math.random() * candyColors.length)];
                }

                candy.innerText = randomColor;
                candy.className = 'match-cell';
                candy.addEventListener('click', () => clickCandy(candy));
                
                grid.appendChild(candy);
                board.push(candy);
            }
        }

        function clickCandy(cell) {
            if (!isGameActive) return;

            if (!selectedCell) {
                selectedCell = cell;
                cell.classList.add('selected');
            } else {
                if (selectedCell === cell) {
                    selectedCell.classList.remove('selected');
                    selectedCell = null;
                    return;
                }

                const prevId = parseInt(selectedCell.id);
                const currId = parseInt(cell.id);
                const validMoves = [prevId - 1, prevId + 1, prevId - width, prevId + width];
                
                const isLeftEdge = (prevId % width === 0);
                const isRightEdge = (prevId % width === width - 1);
                
                if (isLeftEdge && currId === prevId - 1) validMoves.pop(); 
                if (isRightEdge && currId === prevId + 1) validMoves.pop(); 

                if (validMoves.includes(currId)) {
                    let prev = selectedCell;
                    selectedCell.classList.remove('selected');
                    selectedCell = null;
                    
                    // Swap visuals
                    let temp = prev.innerText;
                    prev.innerText = cell.innerText;
                    cell.innerText = temp;
                    
                    let isMatch = checkMatches();
                    if (!isMatch) {
                        prev.classList.add('invalid');
                        cell.classList.add('invalid');
                        setTimeout(() => {
                            // Swap BACK CORRECTLY
                            let tempBack = prev.innerText;
                            prev.innerText = cell.innerText;
                            cell.innerText = tempBack;
                            
                            prev.classList.remove('invalid');
                            cell.classList.remove('invalid');
                        }, 300);
                    }
                } else {
                    selectedCell.classList.remove('selected');
                    selectedCell = cell;
                    cell.classList.add('selected');
                }
            }
        }

        function checkMatches() {
            let matchFound = false;
            
            // Horizontal
            for (let i = 0; i < 25; i++) {
                if (i % 5 > 2) continue;
                let rowOfThree = [i, i+1, i+2];
                let decidedColor = board[i].innerText;
                if (decidedColor === '') continue;

                if (rowOfThree.every(index => board[index].innerText === decidedColor)) {
                    processMatch(rowOfThree);
                    matchFound = true;
                }
            }

            // Vertical
            for (let i = 0; i < 15; i++) {
                let colOfThree = [i, i+width, i+width*2];
                let decidedColor = board[i].innerText;
                if (decidedColor === '') continue;

                if (colOfThree.every(index => board[index].innerText === decidedColor)) {
                    processMatch(colOfThree);
                    matchFound = true;
                }
            }
            return matchFound;
        }

        function processMatch(indices) {
            score += 10;
            document.getElementById('matchScore').innerText = score;
            
            // Simple Animation & Respawn
            indices.forEach(index => {
                board[index].style.transform = "scale(0)";
                setTimeout(()=> {
                    let randomColor = candyColors[Math.floor(Math.random() * candyColors.length)];
                    board[index].innerText = randomColor;
                    board[index].style.transform = "scale(1)";
                }, 200);
            });
        }


        // 2. Magic Ball Logic
        function openMagicBall() {
            document.getElementById('magicBallModal').classList.remove('hidden');
            document.getElementById('magicAnswer').innerText = "–ó–ê–î–ê–ô –ü–ò–¢–ê–ù–ù–Ø...";
        }

        function shakeBall() {
            const ball = document.getElementById('magicBall');
            ball.classList.add('shake');
            if (navigator.vibrate) navigator.vibrate(200);

            setTimeout(() => {
                ball.classList.remove('shake');
                const answers = ["–¢–∞–∫, –∑–≤—ñ—Å–Ω–æ!", "–ù—ñ", "–ú–æ–∂–ª–∏–≤–æ", "–°–ø–∏—Ç–∞–π –Ü–ª–ª—é", "–ó—ñ—Ä–∫–∏ –∫–∞–∂—É—Ç—å –¢–ê–ö", "–°—É–º–Ω—ñ–≤–Ω–æ"];
                document.getElementById('magicAnswer').innerText = answers[Math.floor(Math.random() * answers.length)];
            }, 500);
        }

        // 3. Breathe Logic
        function openBreathe() {
            document.getElementById('breatheModal').classList.remove('hidden');
        }

        // --- ADMIN PANEL LOGIC ---
        function openAdminPanel() {
            document.getElementById('adminModal').classList.remove('hidden');
            document.getElementById('adminAuth').classList.remove('hidden');
            document.getElementById('adminControls').classList.add('hidden');
            document.getElementById('adminPass').value = '';
        }

        function checkAdminPass() {
            const pass = document.getElementById('adminPass').value;
            if (pass === CONFIG.adminPass) {
                document.getElementById('adminAuth').classList.add('hidden');
                document.getElementById('adminControls').classList.remove('hidden');
                document.getElementById('newCoinBalance').value = appState.coins;
            } else {
                showToast("–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å üö´");
            }
        }

        function saveAdminChanges() {
            const newCoins = parseInt(document.getElementById('newCoinBalance').value);
            if (!isNaN(newCoins)) {
                appState.coins = newCoins;
                saveState();
                updateBalance();
                showToast("–ë–∞–ª–∞–Ω—Å –æ–Ω–æ–≤–ª–µ–Ω–æ! ‚úÖ");
                closeModal('adminModal');
            }
        }

        // --- CORE FUNCTIONS ---

        let timerInterval;
        let timerClicks = 0;

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            function update() {
                const now = new Date();
                const diff = now - CONFIG.startDate;
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
                const minutes = Math.floor((diff / (1000 * 60)) % 60);
                const seconds = Math.floor((diff / 1000) % 60);
                const dayEl = document.getElementById('daysCounter');
                const timeEl = document.getElementById('timeCounter');
                if (dayEl) dayEl.innerText = days;
                if (timeEl) timeEl.innerText = `${String(hours).padStart(2, '0')} –≥–æ–¥ ${String(minutes).padStart(2, '0')} —Ö–≤ ${String(seconds).padStart(2, '0')} —Å`;
            }
            update();
            timerInterval = setInterval(update, 1000);
        }

        function handleTimerClick() {
            if (appState.easterEggClaimed) return;

            timerClicks++;
            if (timerClicks === 10) {
                appState.easterEggClaimed = true;
                confetti({
                    particleCount: 200,
                    spread: 100,
                    origin: { y: 0.6 },
                    colors: ['#ff69b4', '#ffffff']
                });
                showToast("–ü–ê–°–•–ê–õ–ö–ê! +50 –º–æ–Ω–µ—Ç!");
                appState.coins += 50;
                saveState();
                timerClicks = 0;
            }
        }

        let selectedItem = null;

        function openBuyModal(item) {
            if (appState.coins < item.price) {
                showToast("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –º–æ–Ω–µ—Ç ü•∫");
                return;
            }
            selectedItem = item;
            
            // Logic for Quantity Slider
            const qtyControl = document.getElementById('quantityControl');
            if (item.multiple) {
                qtyControl.classList.remove('hidden');
                purchaseQty = 1;
                document.getElementById('quantityValue').innerText = 1;
                document.getElementById('quantityRange').value = 1;
                document.getElementById('modalPrice').innerText = item.price;
                
                // Listener
                document.getElementById('quantityRange').oninput = function() {
                    purchaseQty = this.value;
                    document.getElementById('quantityValue').innerText = purchaseQty;
                    document.getElementById('modalPrice').innerText = item.price * purchaseQty;
                };
            } else {
                qtyControl.classList.add('hidden');
                purchaseQty = 1;
                document.getElementById('modalPrice').innerText = item.price;
            }

            document.getElementById('buyModal').classList.remove('hidden');
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
        }

        function confirmPurchase() {
            if (!selectedItem) return;
            const finalPrice = selectedItem.price * purchaseQty;
            
            if (appState.coins < finalPrice) {
                showToast("–ù–µ –≤–∏—Å—Ç–∞—á–∞—î –º–æ–Ω–µ—Ç –¥–ª—è —Ç–∞–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ!");
                return;
            }

            appState.coins -= finalPrice;
            appState.purchases.push({ itemId: selectedItem.id, ts: Date.now() });
            saveState();
            closeModal('buyModal');
            
            if (currentRoute === 'store') {
                renderStore(document.getElementById('mainContent'));
            }

            const ticketModal = document.getElementById('ticketModal');
            document.getElementById('ticketTitle').innerText = selectedItem.title;
            
            // Show Quantity in Ticket
            const qtyText = purchaseQty > 1 ? `(–ö—ñ–ª—å–∫—ñ—Å—Ç—å: ${purchaseQty})` : "";
            document.getElementById('ticketQty').innerText = qtyText;
            
            document.getElementById('ticketId').innerText = `LOVE-${Math.floor(Math.random()*10000)}`;
            
            const subject = encodeURIComponent(`OurSpace: –í—ñ—Ç—É—Å—å–∫–∞ –∫—É–ø–∏–ª–∞ ${selectedItem.title}!`);
            const body = encodeURIComponent(`–ü—Ä–∏–≤—ñ—Ç, –Ü–ª–ª—è!\n\n–Ø —â–æ–π–Ω–æ –∫—É–ø–∏–ª–∞ "${selectedItem.title}" ${purchaseQty > 1 ? '—É –∫—ñ–ª—å–∫–æ—Å—Ç—ñ ' + purchaseQty : ''} –∑–∞ ${finalPrice} –º–æ–Ω–µ—Ç.\n\n–ö–æ–ª–∏ –≤–∏–∫–æ–Ω–∞—î—à? ‚ù§Ô∏è`);
            document.getElementById('emailLink').href = `mailto:${CONFIG.email}?subject=${subject}&body=${body}`;
            ticketModal.classList.remove('hidden');
            confetti({ particleCount: 150, spread: 60 });
        }

        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-24 left-0 right-0 mx-auto w-fit bg-white/10 backdrop-blur-md border border-white/20 px-6 py-3 rounded-full text-sm font-bold shadow-xl z-[100] text-center animate-toast-in';
            toast.innerText = msg;
            document.body.appendChild(toast);
    
            setTimeout(() => {
                toast.classList.remove('animate-toast-in');
                toast.classList.add('animate-toast-out');
                setTimeout(() => {
                    toast.remove();
                }, 500);
            }, 3000);
        }

        window.onload = init;
    </script>
</body>
</html>
